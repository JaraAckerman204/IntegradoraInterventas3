<app-header></app-header>

<ion-content>

  <div class="admin-hero">
    <div class="hero-content">
      <div class="hero-icon">
        <ion-icon name="construct-outline"></ion-icon>
      </div>
      <h1>Panel de Administraci√≥n</h1>
      <p>Gestiona productos, usuarios y mensajes del sistema</p>
    </div>
  </div>

  <section class="admin-section">
    <div class="admin-container">

      <div class="tabs-navigation">
        <button 
          class="tab-btn" 
          [class.active]="tabActiva === 'productos'"
          (click)="cambiarTab('productos')">
          <ion-icon name="cube-outline"></ion-icon>
          <span>Productos</span>
        </button>
        
        <button 
          class="tab-btn" 
          [class.active]="tabActiva === 'usuarios'"
          (click)="cambiarTab('usuarios')">
          <ion-icon name="people-outline"></ion-icon>
          <span>Usuarios</span>
        </button>
        
        <button 
          class="tab-btn" 
          [class.active]="tabActiva === 'mensajes'"
          (click)="cambiarTab('mensajes')">
          <ion-icon name="mail-outline"></ion-icon>
          <span>Mensajes</span>
        </button>
        
        <button 
          class="tab-btn" 
          [class.active]="tabActiva === 'newsletter'"
          (click)="cambiarTab('newsletter')">
          <ion-icon name="newspaper-outline"></ion-icon>
          <span>Newsletter</span>
        </button>
      </div>
      
      <div class="tab-content">
        
        <!-- ====================== -->
        <!-- TAB: PRODUCTOS -->
        <!-- ====================== -->
        <div *ngIf="tabActiva === 'productos'" class="content-wrapper" data-tab="productos">
  <div class="content-header">
    <div>
      <h2>Gesti√≥n de Productos</h2>
      <p>Administra tu cat√°logo de productos</p>
    </div>
    <div class="header-actions">
      <button class="btn-search" (click)="abrirModalBusqueda()">
        <ion-icon name="search-outline"></ion-icon>
        <span>Buscar</span>
      </button>
      <button class="btn-add-product" (click)="abrirModalProducto()">
        <ion-icon name="add-circle-outline"></ion-icon>
        <span>Agregar Producto</span>
      </button>
    </div>
  </div>

  <!-- üîç FILTROS ACTIVOS -->
<div class="active-filters" *ngIf="filtroNombre || filtroSku || filtroMarca || filtroCategoria || filtroSubcategoria">
  <div class="filter-header">
    <ion-icon name="filter-outline"></ion-icon>
    <span>Filtros activos:</span>
  </div>
  <div class="filter-tags">
    <div class="filter-tag" *ngIf="filtroNombre">
      <span>Nombre: {{ filtroNombre }}</span>
      <button (click)="limpiarFiltroNombre()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroSku">
      <span>SKU: {{ filtroSku }}</span>
      <button (click)="limpiarFiltroSku()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroMarca">
      <span>Marca: {{ filtroMarca }}</span>
      <button (click)="limpiarFiltroMarca()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroCategoria">
      <span>Categor√≠a: {{ filtroCategoria }}</span>
      <button (click)="limpiarFiltroCategoria()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroSubcategoria">
      <span>Subcategor√≠a: {{ filtroSubcategoria }}</span>
      <button (click)="limpiarFiltroSubcategoria()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <button class="clear-all-btn" (click)="limpiarTodosFiltros()">
      Limpiar todos
    </button>
  </div>
</div>

  <!-- üßæ TARJETAS DE PRODUCTOS -->
  <div class="products-grid" *ngIf="productosFiltrados.length > 0">
    <div class="product-card" *ngFor="let producto of productosFiltrados">
      
      <!-- IMAGEN DEL PRODUCTO -->
      <div class="product-image">
        <img [src]="producto.imagen || 'https://ionicframework.com/docs/img/demos/thumbnail.svg'" 
             alt="{{ producto.nombre }}" />
      </div>

      <!-- CONTENIDO COMPRIMIDO -->
      <div class="product-content">
        
        <!-- NOMBRE Y SKU EN UNA L√çNEA -->
        <div class="product-header">
          <h4 class="product-name">{{ producto.nombre }}</h4>
          <span class="product-sku" *ngIf="producto.sku">SKU: {{ producto.sku }}</span>
        </div>

        <!-- CATEGOR√çA Y MARCA COMPRIMIDA -->
        <div class="product-details">
          <span class="detail-item" *ngIf="producto.categoria">
            <ion-icon name="folder-outline"></ion-icon>
            {{ producto.categoria }}
          </span>
          <span class="detail-item" *ngIf="producto.marca">
            <ion-icon name="ribbon-outline"></ion-icon>
            Marca: {{ producto.marca }}
          </span>
        </div>
        <!-- MODALIDADES DISPONIBLES -->
    <div class="product-modalidades" *ngIf="getModalidadesDisponibles(producto).length > 0">
      <span class="modalidad-badge" *ngIf="tieneModalidad(producto, 'Mayoreo')">
        <ion-icon name="cart-outline"></ion-icon>
        Mayoreo
      </span>
      <span class="modalidad-badge" *ngIf="tieneModalidad(producto, 'Menudeo')">
        <ion-icon name="cart-outline"></ion-icon>
        Menudeo
      </span>
    </div>
      </div>

      <!-- BOTONES DE ACCI√ìN (FOOTER) -->
      <div class="product-footer">
        <button class="btn-edit" (click)="editarProducto(producto)" title="Editar">
          <ion-icon name="create-outline"></ion-icon>
          <span>Editar</span>
        </button>
        <button class="btn-delete" (click)="eliminarProducto(producto.id)" title="Eliminar">
          <ion-icon name="trash-outline"></ion-icon>
          <span>Eliminar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ESTADO VAC√çO - SIN RESULTADOS DE B√öSQUEDA -->
  <div class="empty-state" *ngIf="productosFiltrados.length === 0 && (filtroNombre || filtroMarca)">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron productos</h4>
    <p>Intenta con otros t√©rminos de b√∫squeda</p>
  </div>

  <!-- ESTADO VAC√çO - SIN PRODUCTOS -->
  <div class="empty-state" *ngIf="productos.length === 0">
    <div class="empty-icon">
      <ion-icon name="cube-outline"></ion-icon>
    </div>
    <h4>No hay productos</h4>
    <p>Agrega tu primer producto para comenzar</p>
  </div>
        </div>
        
        <!-- ====================== -->
        <!-- TAB: USUARIOS -->
        <!-- ====================== -->
        <div *ngIf="tabActiva === 'usuarios'" class="content-wrapper" data-tab="usuarios">
<div class="content-header">
  <div>
    <h2>Usuarios Registrados</h2>
    <p>Gestiona los usuarios activos del sistema</p>
  </div>
  <div class="header-actions">
    <button class="btn-search" (click)="abrirModalBusquedaUsuarios()">
      <ion-icon name="search-outline"></ion-icon>
      <span>Buscar</span>
    </button>
    <button class="btn-add-product" (click)="abrirModalAgregarUsuario()">
      <ion-icon name="add-circle-outline"></ion-icon>
      <span>Agregar Usuario</span>
    </button>
  </div>
</div>

  <!-- üìä ESTAD√çSTICAS -->
  <div class="users-stats">
    <div class="stat-card-user">
      <ion-icon name="people-outline"></ion-icon>
      <div class="stat-content">
        <span class="stat-number">{{ totalUsuarios }}</span>
        <span class="stat-label">Total Usuarios</span>
      </div>
    </div>
    <div class="stat-card-user admin">
      <ion-icon name="shield-checkmark-outline"></ion-icon>
      <div class="stat-content">
        <span class="stat-number">{{ totalAdmins }}</span>
        <span class="stat-label">Administradores</span>
      </div>
    </div>
    <div class="stat-card-user regular">
      <ion-icon name="person-outline"></ion-icon>
      <div class="stat-content">
        <span class="stat-number">{{ totalUsuariosRegulares }}</span>
        <span class="stat-label">Usuarios Regulares</span>
      </div>
    </div>
  </div>

  <!-- üîç FILTROS ACTIVOS -->
<div class="active-filters" *ngIf="filtroNombreUsuario || filtroEmailUsuario || filtroRolUsuario">
  <div class="filter-header">
    <ion-icon name="filter-outline"></ion-icon>
    <span>Filtros activos:</span>
  </div>
  <div class="filter-tags">
    <div class="filter-tag" *ngIf="filtroNombreUsuario">
      <span>Nombre: {{ filtroNombreUsuario }}</span>
      <button (click)="filtroNombreUsuario = ''; aplicarFiltrosUsuarios()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroEmailUsuario">
      <span>Email: {{ filtroEmailUsuario }}</span>
      <button (click)="filtroEmailUsuario = ''; aplicarFiltrosUsuarios()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-tag" *ngIf="filtroRolUsuario">
      <span>Rol: {{ filtroRolUsuario === 'admin' ? 'Administrador' : 'Usuario' }}</span>
      <button (click)="filtroRolUsuario = ''; aplicarFiltrosUsuarios()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <button class="clear-all-btn" (click)="limpiarFiltrosUsuarios()">
      Limpiar todos
    </button>
  </div>
</div>

  <!-- üìã TABLA DE USUARIOS -->
  <div class="users-table-container" *ngIf="usuariosFiltrados.length > 0">
    <div class="users-table">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th width="150">Rol</th>
            <th width="150">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of usuariosFiltrados">
            <td>
              <div class="user-name-cell">
                <ion-icon name="person-outline"></ion-icon>
                <strong>{{ user.nombre || 'Sin nombre' }}</strong>
                <small class="user-id">ID: {{ user.id }}</small>
              </div>
            </td>
            <td>
              <div class="user-email-cell">
                <ion-icon name="mail-outline"></ion-icon>
                <span>{{ user.email }}</span>
              </div>
            </td>
            <td>
              <div class="rol-selector">
                <select 
                  [value]="user.rol || 'usuario'"
                  (change)="cambiarRolUsuario(user.id, $any($event.target).value)"
                  class="rol-select"
                  [class.admin]="user.rol === 'admin'">
                  <option value="usuario">Usuario</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
            </td>
            <td>
              <div class="table-actions">
                <button 
                  class="btn-icon-table edit" 
                  (click)="editarUsuario(user)"
                  title="Editar usuario">
                  <ion-icon name="create-outline"></ion-icon>
                </button>
                <button 
                  class="btn-icon-table danger" 
                  (click)="eliminarUsuario(user.id)"
                  title="Eliminar usuario">
                  <ion-icon name="trash-outline"></ion-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ESTADO VAC√çO - SIN USUARIOS -->
  <div class="empty-state" *ngIf="usuarios.length === 0">
    <div class="empty-icon">
      <ion-icon name="people-outline"></ion-icon>
    </div>
    <h4>No hay usuarios</h4>
    <p>No se encontraron usuarios registrados</p>
  </div>

  <!-- ESTADO VAC√çO - SIN RESULTADOS DE B√öSQUEDA -->
  <div class="empty-state" *ngIf="usuarios.length > 0 && usuariosFiltrados.length === 0">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron resultados</h4>
    <p>Intenta con otros t√©rminos de b√∫squeda</p>
  </div>

      <button class="btn-export" (click)="exportarUsuariosCSV()">
      <ion-icon name="download-outline"></ion-icon>
      <span>Exportar CSV</span>
    </button>

        </div>
        

        <!-- ====================== -->
        <!-- TAB: MENSAJES -->
        <!-- ====================== -->
        <div *ngIf="tabActiva === 'mensajes'" class="content-wrapper" data-tab="mensajes">
          <div class="content-header">
            <div>
              <h2>Mensajes Recibidos</h2>
              <p>Gestiona los mensajes de contacto</p>
            </div>
          </div>

          <div class="no-messages" *ngIf="mensajes.length === 0">
            <ion-icon name="mail-open-outline"></ion-icon>
            <p>No hay mensajes a√∫n.</p>
          </div>

          <div class="messages-list" *ngIf="mensajes.length > 0">
            <div *ngFor="let msg of mensajes" class="message-card">
              <h3>{{ msg.name }} <small>{{ msg.email }}</small></h3>
              <p><strong>Tel√©fono:</strong> {{ msg.phone }}</p>
              <p><strong>Empresa:</strong> {{ msg.company || 'N/A' }}</p>
              <p><strong>Mensaje:</strong> {{ msg.message }}</p>
              <p><strong>Fecha:</strong> {{ msg.date | date:'medium' }}</p>

              <div class="message-actions">
                <button class="btn-primary" (click)="responderMensaje(msg.email, msg.message)">
                  <ion-icon name="mail-outline"></ion-icon>
                  Responder
                </button>

                <button class="btn-danger" (click)="eliminarMensaje(msg.id)">
                  <ion-icon name="trash-outline"></ion-icon>
                  Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ====================== -->
        <!-- TAB: NEWSLETTER -->
        <!-- ====================== -->
        <div *ngIf="tabActiva === 'newsletter'" class="content-wrapper" data-tab="newsletter">
          <div class="content-header">
            <div>
              <h2>Newsletter</h2>
              <p>Gestiona suscriptores y env√≠a boletines promocionales</p>
            </div>
            <div class="header-actions">
              <button class="btn-search" (click)="filtroEmailNewsletter ? limpiarFiltroNewsletter() : null">
                <ion-icon [name]="filtroEmailNewsletter ? 'close-outline' : 'search-outline'"></ion-icon>
                <input 
                  type="text" 
                  [(ngModel)]="filtroEmailNewsletter"
                  (ngModelChange)="aplicarFiltroNewsletter()"
                  placeholder="Buscar por email o nombre..."
                  class="search-input-inline">
              </button>
              <button 
                class="btn-send-newsletter" 
                (click)="abrirModalEnviarNewsletter()"
                [disabled]="suscriptores.length === 0">
                <ion-icon name="send-outline"></ion-icon>
                <span>Enviar Newsletter</span>
              </button>
            </div>
          </div>

          <!-- üìä Estad√≠sticas -->
          <div class="newsletter-stats">
            <div class="stat-card-mini">
              <ion-icon name="people-outline"></ion-icon>
              <div class="stat-content">
                <span class="stat-number">{{ suscriptores.length }}</span>
                <span class="stat-label">Suscriptores</span>
              </div>
            </div>
            <div class="stat-card-mini">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              <div class="stat-content">
                <span class="stat-number">{{ suscriptoresFiltrados.length }}</span>
                <span class="stat-label">Mostrados</span>
              </div>
            </div>
            <div class="stat-card-mini" *ngIf="suscriptoresSeleccionados.size > 0">
              <ion-icon name="mail-outline"></ion-icon>
              <div class="stat-content">
                <span class="stat-number">{{ suscriptoresSeleccionados.size }}</span>
                <span class="stat-label">Seleccionados</span>
              </div>
            </div>
          </div>

          <!-- üìã Tabla de Suscriptores -->
          <div class="subscribers-table-container" *ngIf="suscriptoresFiltrados.length > 0">
            
            <!-- Controles de selecci√≥n -->
            <div class="table-controls">
              <label class="checkbox-control">
                <input 
                  type="checkbox" 
                  [(ngModel)]="seleccionarTodos"
                  (change)="toggleSeleccionarTodos()">
                <span>Seleccionar todos ({{ suscriptoresFiltrados.length }})</span>
              </label>
            </div>

            <!-- Tabla -->
            <div class="subscribers-table">
              <table>
                <thead>
                  <tr>
                    <th width="50">
                      <ion-icon name="checkmark-outline"></ion-icon>
                    </th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Fecha de Suscripci√≥n</th>
                    <th width="100">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let suscriptor of suscriptoresFiltrados">
                    <td>
                      <label class="checkbox-control-cell">
                        <input 
                          type="checkbox" 
                          [checked]="suscriptoresSeleccionados.has(suscriptor.id)"
                          (change)="toggleSuscriptorSeleccion(suscriptor.id)">
                      </label>
                    </td>
                    <td>
                      <div class="subscriber-name">
                        <ion-icon name="person-outline"></ion-icon>
                        <span>{{ suscriptor.nombre }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="subscriber-email">
                        <ion-icon name="mail-outline"></ion-icon>
                        <span>{{ suscriptor.email }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="subscriber-date">
                        <ion-icon name="calendar-outline"></ion-icon>
                        <span>{{ suscriptor.fechaSuscripcion | date:'short' }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="table-actions">
                        <button 
                          class="btn-icon-table danger" 
                          (click)="eliminarSuscriptor(suscriptor.id)"
                          title="Eliminar suscriptor">
                          <ion-icon name="trash-outline"></ion-icon>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Estado vac√≠o -->
          <div class="empty-state" *ngIf="suscriptores.length === 0">
            <div class="empty-icon">
              <ion-icon name="newspaper-outline"></ion-icon>
            </div>
            <h4>No hay suscriptores</h4>
            <p>Los usuarios que se suscriban al newsletter aparecer√°n aqu√≠</p>
          </div>

          <!-- Sin resultados de b√∫squeda -->
          <div class="empty-state" *ngIf="suscriptores.length > 0 && suscriptoresFiltrados.length === 0">
            <div class="empty-icon">
              <ion-icon name="search-outline"></ion-icon>
            </div>
            <h4>No se encontraron resultados</h4>
            <p>Intenta con otros t√©rminos de b√∫squeda</p>
            <button class="btn-clear-filter" (click)="limpiarFiltroNewsletter()">
              <ion-icon name="refresh-outline"></ion-icon>
              <span>Limpiar b√∫squeda</span>
            </button>
          </div>
        </div>

      </div>
    </div>
  </section>



<!-- üé® MODAL CONFIRMAR ELIMINACI√ìN SUSCRIPTOR -->
<div class="modal-overlay" *ngIf="mostrarModalEliminarSuscriptor" (click)="cerrarModalEliminarSuscriptor()">
    <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon delete-icon">
              <ion-icon name="trash-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>¬øEliminar suscriptor?</h2>
              <p>Esta acci√≥n no se puede deshacer</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalEliminarSuscriptor()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          <div class="delete-warning">
            <ion-icon name="warning-outline"></ion-icon>
            <p>El suscriptor ser√° eliminado permanentemente del sistema. Esta acci√≥n es irreversible.</p>
          </div>
        </div>

        <!-- üìò Botones -->
        <div class="modal-footer-custom">
          <button 
            type="button"
            (click)="cerrarModalEliminarSuscriptor()"
            class="btn-cancel">
            <ion-icon name="close-outline"></ion-icon>
            <span>Cancelar</span>
          </button>
          
          <button 
            type="button"
            (click)="confirmarEliminacionSuscriptor()"
            class="btn-delete">
            <ion-icon name="trash-outline"></ion-icon>
            <span>Eliminar</span>
          </button>
        </div>

      </div>
    </div>
</div>

<!-- üé® MODAL ENVIAR NEWSLETTER -->
<div class="modal-overlay" *ngIf="mostrarModalEnviarNewsletter" (click)="cerrarModalEnviarNewsletter()">
    <div class="modal-container newsletter-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="send-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Enviar Newsletter</h2>
              <p>Crea y env√≠a tu bolet√≠n promocional a los Suscriptores</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalEnviarNewsletter()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom newsletter-body">
          
          <!-- Alerta de destinatarios -->
          <div class="alert-box info" *ngIf="suscriptoresSeleccionados.size === 0">
            <ion-icon name="information-circle-outline"></ion-icon>
            <div>
              <strong>Selecciona destinatarios</strong>
              <p>Debes seleccionar al menos un suscriptor antes de enviar</p>
            </div>
          </div>

          <div class="alert-box success" *ngIf="suscriptoresSeleccionados.size > 0">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <div>
              <strong>Se han seleccionado <b>{{ suscriptoresSeleccionados.size }}</b> suscriptores.</strong>
              <p>El newsletter se enviar√° a estos suscriptores</p>
            </div>
          </div>

          <!-- üìù Formulario -->
          <form (ngSubmit)="enviarNewsletter()" #newsletterForm="ngForm">
            
            <!-- Asunto -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="text-outline"></ion-icon>
                <span>Asunto del correo</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="asuntoNewsletter" 
                  name="asunto" 
                  placeholder="Ej: ¬°Nuevas Ofertas Exclusivas! üéâ" 
                  required
                  maxlength="150"
                  class="custom-input">
              </div>
              <div class="input-hint">
                <ion-icon name="bulb-outline"></ion-icon>
                <span>Un asunto atractivo aumenta la tasa de apertura</span>
              </div>
            </div>

            <!-- Mensaje -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="document-text-outline"></ion-icon>
                <span>Contenido del Newsletter</span>
              </label>
              <div class="input-wrapper textarea-wrapper">
                <textarea 
                  [(ngModel)]="mensajeNewsletter" 
                  name="mensaje" 
                  placeholder="Escribe aqu√≠ tu mensaje promocional...

Ejemplo:
¬°Hola! üëã

Te tenemos excelentes noticias. Esta semana tenemos ofertas especiales en toda nuestra l√≠nea de productos desechables.

‚ú® 20% de descuento en vasos t√©rmicos
üéÅ Compra 2 y lleva 3 en platos biodegradables
üì¶ Env√≠o gratis en compras mayores a $500

¬°Aprovecha estas promociones antes de que terminen!

Saludos,
Equipo Interventas"
                  rows="12"
                  required
                  class="custom-textarea"></textarea>
              </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="submit"
                class="btn-submit"
                [disabled]="!newsletterForm.valid || suscriptoresSeleccionados.size === 0 || enviandoNewsletter">
                <span class="spinner" *ngIf="enviandoNewsletter"></span>
                <ion-icon *ngIf="!enviandoNewsletter" name="send-outline"></ion-icon>
                <span>{{ enviandoNewsletter ? 'Enviando...' : 'Enviar Newsletter' }}</span>
              </button>
              
              <button 
                type="button"
                (click)="cerrarModalEnviarNewsletter()"
                class="btn-cancel"
                [disabled]="enviandoNewsletter">
                <ion-icon name="close-outline"></ion-icon>
                <span>Cancelar</span>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
</div>

<!-- üé® MODAL AGREGAR/EDITAR PRODUCTO -->
<div class="modal-overlay" *ngIf="mostrarModalProducto" (click)="cerrarModalProducto()">
  <div class="modal-container product-modal" (click)="$event.stopPropagation()">
    <div class="modal-wrapper">
      
      <!-- üéØ Header del Modal -->
      <div class="modal-header-custom">
        <div class="header-left">
          <div class="header-icon">
            <ion-icon [name]="modoEdicion ? 'create-outline' : 'add-circle-outline'"></ion-icon>
          </div>
          <div class="header-text">
            <h2>{{ modoEdicion ? 'Editar Producto' : 'Agregar Producto' }}</h2>
            <p>{{ modoEdicion ? 'Actualiza la informaci√≥n del producto' : 'Completa los datos del nuevo producto' }}</p>
          </div>
        </div>
        <button class="close-btn" (click)="cerrarModalProducto()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- üìã Contenido del Modal -->
      <div class="modal-body-custom">
        <form (ngSubmit)="guardarProducto()" #productForm="ngForm">
          
          <!-- ========== SECCI√ìN 1: INFORMACI√ìN B√ÅSICA ========== -->
          <div class="form-section-title">
            <ion-icon name="information-circle-outline"></ion-icon>
            <span>Informaci√≥n B√°sica</span>
          </div>

          <!-- SKU Y NOMBRE -->
          <div class="form-row-2col">
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="barcode-outline"></ion-icon>
                <span>SKU</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="producto.sku" 
                  name="sku" 
                  placeholder="Ej: 123456"
                  class="custom-input"
                  required>
              </div>
            </div>

            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="pricetag-outline"></ion-icon>
                <span>Nombre</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="producto.nombre" 
                  name="nombre" 
                  placeholder="Ej: Vaso T√©rmico 16oz" 
                  class="custom-input"
                  required>
              </div>
            </div>
          </div>

          <!-- CATEGOR√çA Y SUBCATEGOR√çA -->
          <div class="form-row-2col">
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="folder-outline"></ion-icon>
                <span>Categor√≠a</span>
              </label>
              <div class="input-wrapper select-custom-wrapper">
                <select 
                  [(ngModel)]="producto.categoria" 
                  (ngModelChange)="onCategoriaChange()"
                  name="categoria" 
                  class="custom-select-native"
                  required>
                  <option value="" disabled selected>Seleccionar categor√≠a</option>
                  <option value="Desechables">Desechables</option>
                  <option value="Biodegradables">Biodegradables</option>
                  <option value="Bolsas">Bolsas</option>
                  <option value="Cocina y Reposter√≠a">Cocina y Reposter√≠a</option>
                  <option value="Alimentos">Alimentos</option>
                  <option value="Higi√©nicos y Servilletas">Higi√©nicos y Servilletas</option>
                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
            </div>

            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="layers-outline"></ion-icon>
                <span>Tipo de {{ producto.categoria || 'Categor√≠a' }}</span>
              </label>
              <div class="input-wrapper select-custom-wrapper" [class.disabled]="!producto.categoria">
                <select 
                  [(ngModel)]="producto.subcategoria" 
                  name="subcategoria" 
                  class="custom-select-native"
                  [disabled]="!producto.categoria"
                  required>
                  <option value="" disabled selected>
                    {{ producto.categoria ? 'Seleccionar tipo' : 'Selecciona una categor√≠a primero' }}
                  </option>
                  <option *ngFor="let sub of subcategorias" [value]="sub">{{ sub }}</option>
                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
            </div>
          </div>

          <!-- MARCA -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="ribbon-outline"></ion-icon>
              <span>Marca</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="producto.marca" 
                name="marca" 
                placeholder="Ej: Dart, Karat, Solo, etc."
                class="custom-input"
                required>
            </div>
          </div>

          <!-- ========== SECCI√ìN 2: MODALIDADES Y OPCIONES ========== -->
          <div class="form-section-title">
            <ion-icon name="cart-outline"></ion-icon>
            <span>Opciones de Venta (Mayoreo / Menudeo)</span>
          </div>

          <!-- SELECCIONAR MODALIDAD -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="cart-outline"></ion-icon>
              <span>Agregar Modalidad</span>
            </label>
            <div class="modalidad-select-wrapper">
              <div class="input-wrapper select-custom-wrapper">
                <select 
                  [(ngModel)]="modalidadSeleccionada" 
                  name="modalidadSeleccionada" 
                  class="custom-select-native"
                  placeholder="Seleccionar Modalidad">
                  <option value="" disabled selected>Seleccionar Modalidad</option>
                  <option value="Menudeo">Menudeo</option>
                  <option value="Mayoreo">Mayoreo</option>

                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
              <button 
                *ngIf="modalidadSeleccionada"
                type="button" 
                class="btn-clear-modalidad"
                (click)="limpiarModalidadSeleccionada()"
                title="Cerrar">
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>
          </div>

          <!-- FORMULARIO PARA AGREGAR OPCIONES -->
          <div class="opcion-modalidad-form" *ngIf="!!modalidadSeleccionada">
            <div class="opcion-form-header">
              <ion-icon name="add-circle-outline"></ion-icon>
              <span>Agregar nueva opci√≥n de {{ modalidadSeleccionada }}</span>
            </div>

            <!-- PRECIO -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="cash-outline"></ion-icon>
                <span>Precio</span>
              </label>
              <div class="input-wrapper price-wrapper">
                <span class="currency-symbol">$</span>
                <input 
                  type="number" 
                  [(ngModel)]="precioActual" 
                  name="precioActual" 
                  placeholder="0.00" 
                  min="0"
                  step="0.01"
                  class="custom-input price-input">
              </div>
            </div>

            <!-- TAMA√ëO (OPCIONAL) -->
            <div class="form-group-custom" style="margin-top: 5px;">
              <label class="form-label-custom">
                <ion-icon name="resize-outline"></ion-icon>
                <span>Tama√±o (Opcional)</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="tamanoActual" 
                  name="tamanoActual" 
                  placeholder="Ej: 16oz, Grande, 500ml"
                  class="custom-input">
              </div>
            </div>

            <!-- CONTENIDO (OPCIONAL) -->
            <div class="form-group-custom" style="margin-top: 5px;">
              <label class="form-label-custom">
                <ion-icon name="layers-outline"></ion-icon>
                <span>Contenido (Opcional)</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="contenidoActual" 
                  name="contenidoActual" 
                  placeholder="Ej: Caja de 100, Bolsa de 50, Empaque individual"
                  class="custom-input">
              </div>
            </div>

            <!-- BOT√ìN AGREGAR OPCI√ìN -->
            <button 
              type="button" 
              class="btn-agregar-opcion"
              (click)="agregarOpcionModalidad()">
              <ion-icon name="add-circle-outline"></ion-icon>
              <span>Agregar Opci√≥n</span>
            </button>
          </div>

          <!-- OPCIONES AGREGADAS - MAYOREO -->
           <div class="form-section-title">
            <ion-icon name="cart-outline"></ion-icon>
            <span>Opciones Agregadas</span>
           </div>
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="cart-outline"></ion-icon>
              <span>Opciones de Mayoreo</span>
            </label>
            
            <!-- Lista de opciones -->
            <div class="opciones-list-wrapper" *ngIf="obtenerOpcionesModalidad('Mayoreo').length > 0">
              <div class="opcion-item-horizontal" *ngFor="let opcion of obtenerOpcionesModalidad('Mayoreo')">
                <span class="opcion-data">Precio: ${{ opcion.precio }}</span>
                <span class="opcion-data">Tama√±o: {{ opcion.tamano }}</span>
                <span class="opcion-data">Contenido: {{ opcion.contenido }}</span>
                <button 
                  type="button" 
                  class="btn-remove-inline"
                  (click)="eliminarOpcionModalidad(opcion.id)"
                  title="Eliminar">
                  <ion-icon name="close-outline"></ion-icon>
                </button>
              </div>
            </div>
            
            <!-- Estado vac√≠o -->
            <div class="empty-hint" *ngIf="obtenerOpcionesModalidad('Mayoreo').length === 0">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>No hay opciones de Mayoreo agregadas</span>
            </div>
          </div>

          <!-- OPCIONES AGREGADAS - MENUDEO -->
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="cart-outline"></ion-icon>
              <span>Opciones de Menudeo</span>
            </label>
            
            <!-- Lista de opciones -->
            <div class="opciones-list-wrapper" *ngIf="obtenerOpcionesModalidad('Menudeo').length > 0">
              <div class="opcion-item-horizontal" *ngFor="let opcion of obtenerOpcionesModalidad('Menudeo')">
                <span class="opcion-data">Precio: ${{ opcion.precio }}</span>
                <span class="opcion-data">Tama√±o: {{ opcion.tamano }}</span>
                <span class="opcion-data">Contenido: {{ opcion.contenido }}</span>
                <button 
                  type="button" 
                  class="btn-remove-inline"
                  (click)="eliminarOpcionModalidad(opcion.id)"
                  title="Eliminar">
                  <ion-icon name="close-outline"></ion-icon>
                </button>
              </div>
            </div>
            
            <!-- Estado vac√≠o -->
            <div class="empty-hint" *ngIf="obtenerOpcionesModalidad('Menudeo').length === 0">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>No hay opciones de Menudeo agregadas</span>
            </div>
          </div>

          <!-- ========== SECCI√ìN 3: SUCURSALES ========== -->
          <div class="form-section-title">
            <ion-icon name="storefront-outline"></ion-icon>
            <span>Sucursales</span>
          </div>

          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="storefront-outline"></ion-icon>
              <span>Agregar Sucursal</span>
            </label>

            <div class="multiple-values-container">
              <div class="value-list" *ngIf="producto.tiendas && producto.tiendas.length > 0">
                <div class="value-item" *ngFor="let tienda of producto.tiendas; let i = index">
                  <span class="value-text">{{ tienda }}</span>
                  <button 
                    type="button" 
                    class="btn-remove-value" 
                    (click)="eliminarTienda(i)"
                    [disabled]="!tieneOpcionesValidas()">
                    <ion-icon name="close-circle"></ion-icon>
                  </button>
                </div>
              </div>

              <div class="add-value-wrapper">
                <div class="input-wrapper" [class.disabled]="!tieneOpcionesValidas()">
                  <input 
                    type="text" 
                    [(ngModel)]="nuevaTienda" 
                    name="nuevaTienda" 
                    placeholder="Ej: Tienda Centro, Sucursal Norte"
                    (keyup.enter)="agregarTienda()"
                    [disabled]="!tieneOpcionesValidas()"
                    class="custom-input">
                </div>
                <button 
                  type="button" 
                  class="btn-add-value" 
                  (click)="agregarTienda()"
                  [disabled]="!tieneOpcionesValidas()">
                  <ion-icon name="add-circle-outline"></ion-icon>
                </button>
              </div>
            </div>

            <div class="input-hint" *ngIf="!tieneOpcionesValidas()">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>Agrega al menos una opci√≥n de Mayoreo o Menudeo para habilitar este campo</span>
            </div>
          </div>

          <!-- ========== SECCI√ìN 4: CONTENIDO ========== -->
          <div class="form-section-title">
            <ion-icon name="document-text-outline"></ion-icon>
            <span>Contenido del Producto</span>
          </div>

          <!-- DESCRIPCI√ìN -->
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="document-text-outline"></ion-icon>
              <span>Descripci√≥n</span>
            </label>
            <div class="input-wrapper textarea-wrapper" [class.disabled]="!tieneOpcionesValidas()">
              <textarea 
                [(ngModel)]="producto.descripcion" 
                name="descripcion" 
                placeholder="Describe las caracter√≠sticas principales del producto..."
                rows="4"
                [disabled]="!tieneOpcionesValidas()"
                class="custom-textarea"></textarea>
            </div>
            <div class="input-hint" *ngIf="!tieneOpcionesValidas()">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>Agrega al menos una opci√≥n de Mayoreo o Menudeo para habilitar este campo</span>
            </div>
          </div>

          <!-- URL DE IMAGEN -->
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="image-outline"></ion-icon>
              <span>URL de la Imagen</span>
            </label>
            <div class="input-wrapper" [class.disabled]="!tieneOpcionesValidas()">
              <input 
                type="text" 
                [(ngModel)]="producto.imagen" 
                name="imagen" 
                placeholder="https://ejemplo.com/imagen.jpg"
                [disabled]="!tieneOpcionesValidas()"
                class="custom-input">
              <ion-icon name="cloud-upload-outline" class="input-icon-right"></ion-icon>
            </div>
            <div class="input-hint" *ngIf="!tieneOpcionesValidas()">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>Agrega al menos una opci√≥n de Mayoreo o Menudeo para habilitar este campo</span>
            </div>
          </div>

          <!-- VISTA PREVIA DE IMAGEN -->
          <div class="image-preview-container" *ngIf="producto.imagen && producto.imagen.trim() !== ''">
            <div class="preview-header">
              <ion-icon name="eye-outline"></ion-icon>
              <span>Vista previa</span>
            </div>
            <div class="preview-image">
              <img 
                [src]="producto.imagen" 
                alt="Preview del producto" />
            </div>
          </div>

          <!-- ========== BOTONES DE ACCI√ìN ========== -->
          <div class="modal-footer-custom">
            <button 
              type="submit"
              class="btn-submit"
              [disabled]="!producto.sku || !producto.sku.trim() ||
                          !producto.nombre || !producto.nombre.trim() || 
                          !producto.categoria || !producto.categoria.trim() ||
                          !producto.subcategoria || !producto.subcategoria.trim() ||
                          !producto.marca || !producto.marca.trim() ||
                          !producto.descripcion || !producto.descripcion.trim() ||
                          !producto.imagen || !producto.imagen.trim() ||
                          !tieneOpcionesValidas()">
              <ion-icon [name]="modoEdicion ? 'checkmark-outline' : 'add-circle-outline'"></ion-icon>
              <span>{{ modoEdicion ? 'Actualizar' : 'Agregar Producto' }}</span>
            </button>
            
            <button 
              type="button"
              (click)="cerrarModalProducto()"
              class="btn-cancel">
              <ion-icon name="close-outline"></ion-icon>
              <span>Cancelar</span>
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- üé® MODAL AGREGAR USUARIO -->
<div class="modal-overlay" *ngIf="mostrarModalAgregarUsuario" (click)="cerrarModalAgregarUsuario()">
  <div class="modal-container user-modal" (click)="$event.stopPropagation()">
    <div class="modal-wrapper">
      <!-- üéØ Header del Modal -->
      <div class="modal-header-custom">
        <div class="header-left">
          <div class="header-icon">
            <ion-icon name="person-add-outline"></ion-icon>
          </div>
          <div class="header-text">
            <h2>Agregar Nuevo Usuario</h2>
            <p>Completa los datos para crear un nuevo usuario</p>
          </div>
        </div>
        <button class="close-btn" (click)="cerrarModalAgregarUsuario()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- üìã Contenido del Modal -->
      <div class="modal-body-custom">
        <form (ngSubmit)="agregarUsuario()" #addUserForm="ngForm">
          
          <!-- Nombre -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="person-outline"></ion-icon>
              <span>Nombre Completo</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="usuarioEditando.nombre" 
                name="nombre" 
                placeholder="Ingresa el nombre completo" 
                required
                class="custom-input">
            </div>
          </div>

          <!-- Email -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="mail-outline"></ion-icon>
              <span>Correo Electr√≥nico</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="email" 
                [(ngModel)]="usuarioCreando.email" 
                name="email" 
                placeholder="ejemplo@correo.com" 
                required
                class="custom-input">
            </div>
            <div class="input-hint">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>El correo debe ser v√°lido y √∫nico</span>
            </div>
          </div>

          <!-- Contrase√±a -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="lock-closed-outline"></ion-icon>
              <span>Contrase√±a</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="password" 
                [(ngModel)]="usuarioEditando.password" 
                name="password" 
                placeholder="M√≠nimo 6 caracteres" 
                required
                minlength="6"
                class="custom-input">
            </div>
            <div class="input-hint">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>Debe tener al menos 6 caracteres</span>
            </div>
          </div>

          <!-- Rol -->
          <div class="form-group-custom">
            <label class="form-label-custom required">
              <ion-icon name="shield-checkmark-outline"></ion-icon>
              <span>Rol del Usuario</span>
            </label>
            <div class="input-wrapper select-custom-wrapper">
              <select 
                [(ngModel)]="usuarioEditando.rol" 
                name="rol" 
                class="custom-select-native">
                <option value="usuario">Usuario</option>
                <option value="admin">Administrador</option>
              </select>
              <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
            </div>
            <div class="input-hint">
              <ion-icon name="information-circle-outline"></ion-icon>
              <span>Los administradores tienen acceso completo al sistema</span>
            </div>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="modal-footer-custom">
            <button 
              type="submit"
              class="btn-submit"
              [disabled]="!addUserForm.valid">
              <ion-icon name="checkmark-outline"></ion-icon>
              <span>Crear Usuario</span>
            </button>
            
            <button 
              type="button"
              (click)="cerrarModalAgregarUsuario()"
              class="btn-cancel">
              <ion-icon name="close-outline"></ion-icon>
              <span>Cancelar</span>
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- üé® MODAL EDITAR USUARIO -->
<div class="modal-overlay" *ngIf="mostrarModalUsuario" (click)="cerrarModalUsuario()">
    <div class="modal-container user-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="create-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Editar Usuario</h2>
              <p>Actualiza la informaci√≥n del usuario</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalUsuario()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          <!-- üìù Formulario -->
          <form (ngSubmit)="guardarUsuarioEditado(usuarioEditandoId)" #userForm="ngForm">
            
            <!-- Nombre -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="person-outline"></ion-icon>
                <span>Nombre Completo</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="usuarioEditando.nombre" 
                  name="nombre" 
                  placeholder="Ingresa el nombre completo" 
                  required
                  class="custom-input"
                  [value]="usuarioEditando.nombre">
              </div>
              <small>Valor actual: {{ usuarioEditando.nombre }}</small>
            </div>

            <!-- Email -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="mail-outline"></ion-icon>
                <span>Correo Electr√≥nico</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="email" 
                  [(ngModel)]="usuarioEditando.email" 
                  name="email" 
                  placeholder="ejemplo@correo.com" 
                  required
                  class="custom-input"
                  [value]="usuarioEditando.email">
              </div>
              <div class="input-hint">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>El correo debe ser v√°lido y √∫nico</span>
              </div>
              <small>Valor actual: {{ usuarioEditando.email }}</small>
            </div>

            <!-- Rol -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="shield-checkmark-outline"></ion-icon>
                <span>Rol del Usuario</span>
              </label>
              <div class="input-wrapper select-custom-wrapper">
                <select 
                  [(ngModel)]="usuarioEditando.rol" 
                  name="rol" 
                  class="custom-select-native"
                  [value]="usuarioEditando.rol">
                  <option value="usuario">Usuario</option>
                  <option value="admin">Administrador</option>
                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
              <div class="input-hint">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>Los administradores tienen acceso completo al sistema</span>
              </div>
              <small>Valor actual: {{ usuarioEditando.rol }}</small>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="submit"
                class="btn-submit"
                [disabled]="!userForm.valid">
                <ion-icon name="checkmark-outline"></ion-icon>
                <span>Guardar Cambios</span>
              </button>
              
              <button 
                type="button"
                (click)="cerrarModalUsuario()"
                class="btn-cancel">
                <ion-icon name="close-outline"></ion-icon>
                <span>Cancelar</span>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
</div>

<!-- üîç MODAL DE B√öSQUEDA DE USUARIOS -->
<div class="modal-overlay" *ngIf="mostrarModalBusquedaUsuarios" (click)="cerrarModalBusquedaUsuarios()">
  <div class="modal-container search-modal" (click)="$event.stopPropagation()">
    <div class="modal-wrapper">
      
      <!-- üéØ Header del Modal -->
      <div class="modal-header-custom">
        <div class="header-left">
          <div class="header-icon">
            <ion-icon name="search-outline"></ion-icon>
          </div>
          <div class="header-text">
            <h2>Buscar Usuarios</h2>
            <p>Filtra usuarios por nombre, email o rol</p>
          </div>
        </div>
        <button class="close-btn" (click)="cerrarModalBusquedaUsuarios()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- üìã Contenido del Modal -->
      <div class="modal-body-custom">
        
        <!-- üîé Formulario de B√∫squeda -->
        <div class="search-form">
          
          <!-- Nombre -->
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="person-outline"></ion-icon>
              <span>Nombre del Usuario</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="filtroNombreUsuario" 
                name="filtroNombreUsuario" 
                placeholder="Ej: Juan, Mar√≠a, Carlos..."
                class="custom-input">
              <button 
                *ngIf="filtroNombreUsuario" 
                class="clear-input-btn" 
                (click)="filtroNombreUsuario = ''">
                <ion-icon name="close-circle"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Email -->
          <div class="form-group-custom" style="margin-top: 10px;">
            <label class="form-label-custom">
              <ion-icon name="mail-outline"></ion-icon>
              <span>Correo Electr√≥nico</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="filtroEmailUsuario" 
                name="filtroEmailUsuario" 
                placeholder="Ej: usuario@ejemplo.com"
                class="custom-input">
              <button 
                *ngIf="filtroEmailUsuario" 
                (click)="filtroEmailUsuario = ''">
                <ion-icon name="close-circle"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Rol -->
          <div class="form-group-custom" style="margin-top: 10px;">
            <label class="form-label-custom">
              <ion-icon name="shield-outline"></ion-icon>
              <span>Rol</span>
            </label>
            <div class="input-wrapper select-custom-wrapper">
              <select 
                [(ngModel)]="filtroRolUsuario" 
                name="filtroRolUsuario" 
                class="custom-select-native">
                <option value="">Todos los roles</option>
                <option value="usuario">Usuario</option>
                <option value="admin">Administrador</option>
              </select>
              <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
            </div>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="modal-footer-custom">
            <button 
              type="button"
              (click)="aplicarFiltrosUsuariosDesdeModal()"
              class="btn-submit">
              <ion-icon name="search-outline"></ion-icon>
              <span>Buscar</span>
            </button>
            
            <button 
              type="button"
              (click)="limpiarFiltrosUsuarios()"
              class="btn-cancel">
              <ion-icon name="refresh-outline"></ion-icon>
              <span>Limpiar Filtros</span>
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- üìç MODAL DE B√öSQUEDA DE PRODUCTOS-->
<div class="modal-overlay" *ngIf="mostrarModalBusqueda" (click)="cerrarModalBusqueda()">
    <div class="modal-container search-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="search-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Buscar Productos</h2>
              <p>Filtra productos por nombre, SKU, marca, categor√≠a o subcategor√≠a</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalBusqueda()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          
          <!-- üîé Formulario de B√∫squeda -->
          <div class="search-form">
            
            <!-- Nombre y SKU en una fila -->
            <div class="form-row-2col">
              <!-- Nombre -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="pricetag-outline"></ion-icon>
                  <span>Nombre del Producto</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    [(ngModel)]="filtroNombre" 
                    name="filtroNombre" 
                    placeholder="Ej: Vaso, Plato, etc."
                    class="custom-input">
                  <button 
                    *ngIf="filtroNombre" 
                    class="clear-input-btn" 
                    (click)="filtroNombre = ''">
                    <ion-icon name="close-circle"></ion-icon>
                  </button>
                </div>
              </div>

              <!-- SKU -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="barcode-outline"></ion-icon>
                  <span>SKU</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    [(ngModel)]="filtroSku" 
                    name="filtroSku" 
                    placeholder="Ej: VSO-TERM-16OZ"
                    class="custom-input">
                  <button 
                    *ngIf="filtroSku" 
                    class="clear-input-btn" 
                    (click)="filtroSku = ''">
                    <ion-icon name="close-circle"></ion-icon>
                  </button>
                </div>
              </div>
            </div>

            <!-- Marca -->
            <div class="form-group-custom">
              <label class="form-label-custom">
                <ion-icon name="ribbon-outline"></ion-icon>
                <span>Marca</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="filtroMarca" 
                  name="filtroMarca" 
                  placeholder="Ej: Dart, Karat, Solo, etc."
                  class="custom-input">
                <button 
                  *ngIf="filtroMarca" 
                  class="clear-input-btn" 
                  (click)="filtroMarca = ''">
                  <ion-icon name="close-circle"></ion-icon>
                </button>
              </div>
            </div>

            <!-- Categor√≠a y Subcategor√≠a en una fila -->
            <div class="form-row-2col" style="margin-top: 10px;">
              <!-- Categor√≠a -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="folder-outline"></ion-icon>
                  <span>Categor√≠a</span>
                </label>
                <div class="input-wrapper select-custom-wrapper">
                  <select 
                    [(ngModel)]="filtroCategoria" 
                    (ngModelChange)="onFiltroCategoriaChange()"
                    name="filtroCategoria" 
                    class="custom-select-native">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Desechables">Desechables</option>
                    <option value="Biodegradables">Biodegradables</option>
                    <option value="Bolsas">Bolsas</option>
                    <option value="Cocina y Reposter√≠a">Cocina y Reposter√≠a</option>
                    <option value="Alimentos">Alimentos</option>
                    <option value="Higi√©nicos y Servilletas">Higi√©nicos y Servilletas</option>
                  </select>
                  <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
                </div>
              </div>

              <!-- Subcategor√≠a -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="layers-outline"></ion-icon>
                  <span>Subcategor√≠a</span>
                </label>
                <div class="input-wrapper select-custom-wrapper" [class.disabled]="!filtroCategoria">
                  <select 
                    [(ngModel)]="filtroSubcategoria" 
                    name="filtroSubcategoria" 
                    class="custom-select-native"
                    [disabled]="!filtroCategoria">
                    <option value="">
                      {{ filtroCategoria ? 'Todas las subcategor√≠as' : 'Selecciona una categor√≠a primero' }}
                    </option>
                    <option *ngFor="let sub of subcategoriasFiltro" [value]="sub">{{ sub }}</option>
                  </select>
                  <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
                </div>
              </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="button"
                (click)="aplicarFiltros()"
                class="btn-submit">
                <ion-icon name="search-outline"></ion-icon>
                <span>Buscar</span>
              </button>
              
              <button 
                type="button"
                (click)="limpiarTodosFiltros()"
                class="btn-cancel">
                <ion-icon name="refresh-outline"></ion-icon>
                <span>Limpiar Filtros</span>
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
</div>
  
</ion-content>