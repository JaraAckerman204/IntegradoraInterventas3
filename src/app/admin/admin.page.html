

<ion-content>
<app-header></app-header>
<!-- üéØ HERO SECTION - ESTILO HOME.PAGE -->
<section class="admin-hero">
  <div class="hero-content">
    <div class="hero-icon">
      <ion-icon name="construct-outline"></ion-icon>
    </div>
    <h1>Panel de Administraci√≥n</h1>
    <p>Gestiona productos, usuarios y mensajes del sistema de forma eficiente</p>
  </div>
</section>

<!-- üìã ADMIN SECTION -->
<section class="admin-section">
  <div class="admin-container">

    <!-- üéØ TABS NAVIGATION -->
    <div class="tabs-navigation">
      <button 
        class="tab-btn" 
        [class.active]="tabActiva === 'productos'"
        (click)="cambiarTab('productos')">
        <ion-icon name="cube-outline"></ion-icon>
        <span>Productos</span>
      </button>
      
      <button 
        class="tab-btn" 
        [class.active]="tabActiva === 'usuarios'"
        (click)="cambiarTab('usuarios')">
        <ion-icon name="people-outline"></ion-icon>
        <span>Usuarios</span>
      </button>
      
      <button 
        class="tab-btn" 
        [class.active]="tabActiva === 'mensajes'"
        (click)="cambiarTab('mensajes')">
        <ion-icon name="mail-outline"></ion-icon>
        <span>Mensajes</span>
      </button>
      
      <button 
        class="tab-btn" 
        [class.active]="tabActiva === 'newsletter'"
        (click)="cambiarTab('newsletter')">
        <ion-icon name="newspaper-outline"></ion-icon>
        <span>Newsletter</span>
      </button>
    </div>
    
    <!-- üìÑ TAB CONTENT -->
    <div class="tab-content">
      
<!-- ====================== -->
<!-- TAB: PRODUCTOS -->
<!-- ====================== -->
<div *ngIf="tabActiva === 'productos'" class="content-wrapper" data-tab="productos">
  
  <!-- Header -->
  <div class="content-header">
    <div>
      <h2>Gesti√≥n de Productos</h2>
      <p>Administra tu cat√°logo completo de productos</p>
    </div>
    <div class="header-actions">
  <button class="btn-add-product" (click)="abrirModalProducto()">
    <ion-icon name="add-circle-outline"></ion-icon>
    <span>Nuevo Producto</span>
  </button>
  <button class="btn-export" (click)="exportarProductosCSV()">
    <ion-icon name="download-outline"></ion-icon>
  </button>
  <input 
    type="file" 
    #csvFileInput
    accept=".csv" 
    (change)="onArchivoCSVSeleccionado($event)"
    style="display: none;">
  <button class="btn-import-csv" (click)="csvFileInput.click()">
    <ion-icon name="cloud-upload-outline"></ion-icon>
  </button>
</div>
  </div>

  <!-- Estad√≠sticas -->
<div class="users-stats">
  <div class="stat-card-user">
    <div class="stat-icon-wrapper">
      <ion-icon name="cube-outline"></ion-icon>
    </div>
    <div class="stat-content">
      <span class="stat-number">{{ productos.length }}</span>
      <span class="stat-label">Total Productos</span>
    </div>
  </div>
  <div class="stat-card-user admin">
    <div class="stat-icon-wrapper">
      <ion-icon name="star-outline"></ion-icon>
    </div>
    <div class="stat-content">
      <span class="stat-number">{{ productosFiltrados.length }}</span>
      <span class="stat-label">Filtrados</span>
    </div>
  </div>
  <div class="stat-card-user regular">
    <div class="stat-icon-wrapper">
      <ion-icon name="checkmark-circle-outline"></ion-icon>
    </div>
    <div class="stat-content">
      <span class="stat-number">{{ productosSeleccionados.size }}</span>
      <span class="stat-label">Seleccionados</span>
    </div>
  </div>
</div>

<!-- B√∫squeda r√°pida + Botones -->
<div class="search-container-wrapper">
  <!-- B√∫squeda R√°pida -->
  <div class="form-group-custom search-group">
    <label class="form-label-custom">
      <ion-icon name="search-outline"></ion-icon>
      <span>B√∫squeda R√°pida</span>
    </label>
    <div class="input-wrapper">
      <input 
        type="text" 
        [(ngModel)]="busquedaRapida"
        (ngModelChange)="aplicarBusquedaRapida()"
        placeholder="Buscar por nombre, SKU o marca..."
        class="custom-input">
      <button 
        *ngIf="busquedaRapida" 
        class="btn-clear-search"
        (click)="limpiarBusquedaRapida()">
        <ion-icon name="close-circle"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Bot√≥n de Ordenamiento -->
  <div class="sort-dropdown-wrapper">
    <button 
      class="btn-sort"
      [class.active]="mostrarMenuOrden"
      (click)="toggleMenuOrden()"
      title="Ordenar productos">
      <ion-icon name="swap-vertical-outline"></ion-icon>
      <span>{{ obtenerTextoOrden() }}</span>
      <ion-icon name="chevron-down-outline" class="chevron-icon"></ion-icon>
    </button>

    <!-- Men√∫ desplegable -->
    <div class="sort-menu" *ngIf="mostrarMenuOrden">
      <div class="sort-menu-header">
        <ion-icon name="funnel-outline"></ion-icon>
        <span>Ordenar por</span>
      </div>
      
      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'nombre-asc'"
        (click)="cambiarOrden('nombre-asc')">
        <ion-icon name="text-outline"></ion-icon>
        <span>Nombre (A-Z)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'nombre-asc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'nombre-desc'"
        (click)="cambiarOrden('nombre-desc')">
        <ion-icon name="text-outline"></ion-icon>
        <span>Nombre (Z-A)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'nombre-desc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'sku-asc'"
        (click)="cambiarOrden('sku-asc')">
        <ion-icon name="barcode-outline"></ion-icon>
        <span>SKU (A-Z)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'sku-asc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'sku-desc'"
        (click)="cambiarOrden('sku-desc')">
        <ion-icon name="barcode-outline"></ion-icon>
        <span>SKU (Z-A)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'sku-desc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'marca-asc'"
        (click)="cambiarOrden('marca-asc')">
        <ion-icon name="ribbon-outline"></ion-icon>
        <span>Marca (A-Z)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'marca-asc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'marca-desc'"
        (click)="cambiarOrden('marca-desc')">
        <ion-icon name="ribbon-outline"></ion-icon>
        <span>Marca (Z-A)</span>
        <ion-icon *ngIf="ordenSeleccionado === 'marca-desc'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>

      <button 
        class="sort-option"
        [class.active]="ordenSeleccionado === 'destacado'"
        (click)="cambiarOrden('destacado')">
        <ion-icon name="star-outline"></ion-icon>
        <span>Destacados primero</span>
        <ion-icon *ngIf="ordenSeleccionado === 'destacado'" name="checkmark-outline" class="check-icon"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Bot√≥n B√∫squeda Avanzada -->
  <button 
    class="btn-advanced-search"
    (click)="abrirModalBusqueda()"
    title="B√∫squeda Avanzada">
    <ion-icon name="filter-outline"></ion-icon>
    <span>B√∫squeda Avanzada</span>
  </button>

  <!-- Bot√≥n Productos Destacados -->
  <button 
    class="btn-featured-toggle"
    [class.active]="filtroDestacado === 'si'"
    (click)="toggleFiltroDestacados()"
    title="Mostrar solo productos destacados">
    <ion-icon name="star-outline"></ion-icon>
    <span>Destacados</span>
  </button>
</div>

  <!-- Filtros activos -->
  <div class="active-filters" *ngIf="tieneFiltrosActivos()">
    <div class="filter-header">
      <ion-icon name="filter-outline"></ion-icon>
      <span>Filtros activos ({{ contarFiltrosActivos() }}):</span>
    </div>
    <div class="filter-tags">
      <div class="filter-tag" *ngIf="filtroCategoria">
        <span>Categor√≠a: {{ filtroCategoria }}</span>
        <button (click)="filtroCategoria = ''; aplicarFiltrosInternos()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="filter-tag" *ngIf="filtroSubcategoria">
        <span>Subcategor√≠a: {{ filtroSubcategoria }}</span>
        <button (click)="filtroSubcategoria = ''; aplicarFiltrosInternos()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="filter-tag" *ngIf="filtroMarca">
        <span>Marca: {{ filtroMarca }}</span>
        <button (click)="filtroMarca = ''; aplicarFiltrosInternos()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="filter-tag" *ngIf="filtroDestacado">
        <span>Estado: {{ filtroDestacado === 'si' ? 'Destacados' : 'No destacados' }}</span>
        <button (click)="filtroDestacado = ''; aplicarFiltrosInternos()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de productos -->
<div class="users-table-container" *ngIf="productosFiltrados.length > 0">
  <div class="table-controls">
    <label class="checkbox-control">
      <input 
        type="checkbox" 
        [(ngModel)]="seleccionarTodosProductos"
        (change)="toggleSeleccionarTodosProductos()">
      <span>Seleccionar todos</span>
    </label>
    <button 
      *ngIf="productosSeleccionados.size > 0"
      class="btn-icon-table danger" 
      (click)="eliminarProductosSeleccionados()"
      style="margin-left: auto;">
      <ion-icon name="trash-outline"></ion-icon>
      Eliminar seleccionados
    </button>
  </div>
  
  <div class="users-table">
    <table>
      <thead>
        <tr>
          <th width="40">‚úì</th>
          <th width="80">Imagen</th>
          <th>Producto</th>
          <th width="140">Categor√≠a</th>
          <th width="120">Marca</th>
          <th width="180">Modalidades</th> <!-- ‚úÖ NUEVA COLUMNA -->
          <th width="110" style="text-align: center;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let producto of productosFiltrados">
          <td>
            <input 
              type="checkbox" 
              [checked]="productosSeleccionados.has(producto.id)"
              (change)="toggleProductoSeleccion(producto.id)"
              style="width: 20px; height: 20px; cursor: pointer; accent-color: #ed1370;">
          </td>
          
          <td>
            <div style="width: 64px; height: 64px; border-radius: 10px; overflow: hidden; background: #f8f9fa; border: 2px solid #e9ecef;">
              <img [src]="producto.imagen || 'https://ionicframework.com/docs/img/demos/thumbnail.svg'" 
                   [alt]="producto.nombre"
                   style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </td>
          
          <td>
            <div style="display: flex; flex-direction: column; gap: 6px;">
              <strong style="font-family: var(--font-primary); font-weight: 800; font-size: 1em; color: #27318d;">
                {{ producto.nombre }}
              </strong>
              <div style="display: flex; gap: 10px; align-items: center;">
                <span style="display: inline-flex; padding: 4px 10px; background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%); border-radius: 8px; font-size: 0.75em; font-weight: 700; color: #6c757d;">
                  {{ producto.sku }}
                </span>
                <span *ngIf="producto.destacado" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%); border-radius: 8px; font-size: 0.7em; font-weight: 800; color: white;">
                  <ion-icon name="star" style="font-size: 13px;"></ion-icon> Destacado
                </span>
              </div>
              <span style="font-size: 0.85em; color: #6c757d;">{{ producto.subcategoria }}</span>
            </div>
          </td>
          
          <td>
            <span style="display: inline-block; padding: 8px 14px; background: linear-gradient(135deg, rgba(39, 49, 141, 0.1) 0%, rgba(237, 19, 112, 0.1) 100%); border: 2px solid rgba(39, 49, 141, 0.4); border-radius: 10px; font-size: 0.85em; font-weight: 700; color: #27318d; font-family: var(--font-primary);">
              {{ producto.categoria }}
            </span>
          </td>
          
          <td>
            <span style="font-size: 0.95em; color: #212529;">{{ producto.marca }}</span>
          </td>
          
          <!-- ‚úÖ NUEVA COLUMNA DE MODALIDADES -->
          <td>
            <div class="modalidades-cell">
              <!-- Menudeo -->
              <div class="modalidad-badge menudeo" *ngIf="tieneModalidad(producto, 'Menudeo')">
                <ion-icon name="cart-outline"></ion-icon>
                <div class="modalidad-info">
                  <span class="modalidad-tipo">Menudeo</span>
                  <span class="modalidad-precio">{{ obtenerPrecioModalidad(producto, 'Menudeo') }}</span>
                </div>
              </div>
              
              <!-- Mayoreo -->
              <div class="modalidad-badge mayoreo" *ngIf="tieneModalidad(producto, 'Mayoreo')">
                <ion-icon name="basket-outline"></ion-icon>
                <div class="modalidad-info">
                  <span class="modalidad-tipo">Mayoreo</span>
                  <span class="modalidad-precio">{{ obtenerPrecioModalidad(producto, 'Mayoreo') }}</span>
                </div>
              </div>
              
              <!-- Sin modalidades -->
              <div class="sin-modalidades" *ngIf="!tieneModalidad(producto, 'Menudeo') && !tieneModalidad(producto, 'Mayoreo')">
                <ion-icon name="alert-circle-outline"></ion-icon>
                <span>Sin modalidades</span>
              </div>
            </div>
          </td>
          
          <td style="text-align: center;">
            <div class="table-actions">
              <button 
                class="btn-icon-table edit"
                (click)="editarProducto(producto)"
                title="Editar">
                <ion-icon name="create-outline"></ion-icon>
              </button>
              <button 
                class="btn-icon-table danger"
                (click)="eliminarProducto(producto.id)"
                title="Eliminar">
                <ion-icon name="trash-outline"></ion-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

  <!-- Estado vac√≠o -->
  <div class="empty-state" *ngIf="productosFiltrados.length === 0 && productos.length > 0">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron productos</h4>
    <p>Intenta ajustar los filtros de b√∫squeda</p>
  </div>

  <div class="empty-state" *ngIf="productos.length === 0">
    <div class="empty-icon">
      <ion-icon name="cube-outline"></ion-icon>
    </div>
    <h4>No hay productos registrados</h4>
    <p>Comienza agregando tu primer producto al cat√°logo</p>
    <button class="btn-add-product" (click)="abrirModalProducto()" style="margin-top: 20px;">
      <ion-icon name="add-circle-outline"></ion-icon>
      <span>Agregar primer producto</span>
    </button>
  </div>

</div>

<!-- ====================== -->
<!-- TAB: USUARIOS -->
<!-- ====================== -->
<div *ngIf="tabActiva === 'usuarios'" class="content-wrapper" data-tab="usuarios">
  
  <!-- Header -->
  <div class="content-header">
    <div>
      <h2>Gesti√≥n de Usuarios</h2>
      <p>Administra los usuarios activos del sistema</p>
    </div>
    <div class="header-actions">
      <button class="btn-search" (click)="abrirModalBusquedaUsuarios()">
        <ion-icon name="search-outline"></ion-icon>
        <span>B√∫squeda Avanzada</span>
      </button>
      <button class="btn-export" (click)="exportarUsuariosCSV()">
        <ion-icon name="download-outline"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Estad√≠sticas -->
  <div class="users-stats">
    <div class="stat-card-user">
      <div class="stat-icon-wrapper">
        <ion-icon name="people-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ totalUsuarios }}</span>
        <span class="stat-label">Total Usuarios</span>
      </div>
    </div>
    <div class="stat-card-user admin">
      <div class="stat-icon-wrapper">
        <ion-icon name="shield-checkmark-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ totalAdmins }}</span>
        <span class="stat-label">Administradores</span>
      </div>
    </div>
    <div class="stat-card-user regular">
      <div class="stat-icon-wrapper">
        <ion-icon name="person-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ totalUsuariosRegulares }}</span>
        <span class="stat-label">Usuarios Regulares</span>
      </div>
    </div>
  </div>

<!-- B√∫squeda r√°pida + Botones - USUARIOS -->
<div class="users-search-wrapper">
  <!-- B√∫squeda R√°pida -->
  <div class="form-group-custom users-search-group">
    <label class="form-label-custom">
      <ion-icon name="search-outline"></ion-icon>
      <span>B√∫squeda R√°pida</span>
    </label>
    <div class="input-wrapper">
      <input 
        type="text" 
        [(ngModel)]="filtroNombreUsuario"
        (ngModelChange)="aplicarFiltrosUsuarios()"
        placeholder="Buscar por nombre o email..."
        class="custom-input">
      <button 
        *ngIf="filtroNombreUsuario" 
        class="btn-clear-search"
        (click)="limpiarFiltrosUsuarios()">
        <ion-icon name="close-circle"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Bot√≥n B√∫squeda Avanzada -->
  <button 
    class="btn-users-advanced-search"
    (click)="abrirModalBusquedaUsuarios()"
    title="B√∫squeda Avanzada">
    <ion-icon name="filter-outline"></ion-icon>
    <span>B√∫squeda Avanzada</span>
  </button>

  <!-- Bot√≥n Filtro Administradores -->
  <button 
    class="btn-users-filter-toggle"
    [class.active]="filtroRolUsuario === 'admin'"
    (click)="toggleFiltroAdmin()"
    title="Mostrar solo administradores">
    <ion-icon name="shield-checkmark-outline"></ion-icon>
    <span>Administradores</span>
  </button>
</div>

  <!-- Filtros activos -->
  <div class="active-filters" *ngIf="filtroNombreUsuario || filtroEmailUsuario || filtroRolUsuario">
    <div class="filter-header">
      <ion-icon name="filter-outline"></ion-icon>
      <span>Filtros activos ({{ contarFiltrosActivosUsuarios() }}):</span>
    </div>
    <div class="filter-tags">
      <div class="filter-tag" *ngIf="filtroNombreUsuario">
        <span>Nombre: {{ filtroNombreUsuario }}</span>
        <button (click)="filtroNombreUsuario = ''; aplicarFiltrosUsuarios()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="filter-tag" *ngIf="filtroEmailUsuario">
        <span>Email: {{ filtroEmailUsuario }}</span>
        <button (click)="filtroEmailUsuario = ''; aplicarFiltrosUsuarios()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="filter-tag" *ngIf="filtroRolUsuario">
        <span>Rol: {{ filtroRolUsuario === 'admin' ? 'Administrador' : 'Usuario' }}</span>
        <button (click)="filtroRolUsuario = ''; aplicarFiltrosUsuarios()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de usuarios -->
  <div class="users-table-container" *ngIf="usuariosFiltrados.length > 0">
    <div class="users-table">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th width="150">Rol</th>
            <th width="110" style="text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of usuariosFiltrados">
            <td>
              <div style="display: flex; flex-direction: column; gap: 6px;">
                <strong style="font-family: var(--font-primary); font-weight: 800; font-size: 1em; color: #27318d;">
                  {{ user.nombre || 'Sin nombre' }}
                </strong>
                <span style="font-size: 0.75em; color: #6c757d; font-family: 'Courier New', monospace;">
                  ID: {{ user.id }}
                </span>
              </div>
            </td>
            
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <ion-icon name="mail-outline" style="font-size: 20px; color: #ed1370;"></ion-icon>
                <span style="font-size: 0.9em; color: #212529;">{{ user.email }}</span>
              </div>
            </td>
            
            <td>
              <div class="rol-selector">
                <select 
                  [value]="user.rol || 'usuario'"
                  (change)="cambiarRolUsuario(user.id, $any($event.target).value)"
                  class="rol-select"
                  [class.admin]="user.rol === 'admin'">
                  <option value="usuario">Usuario</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
            </td>
            
            <td style="text-align: center;">
              <div class="table-actions">
                <button 
                  class="btn-icon-table edit"
                  (click)="editarUsuario(user)"
                  title="Editar">
                  <ion-icon name="create-outline"></ion-icon>
                </button>
                <button 
                  class="btn-icon-table danger"
                  (click)="eliminarUsuario(user.id)"
                  title="Eliminar">
                  <ion-icon name="trash-outline"></ion-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div class="empty-state" *ngIf="usuariosFiltrados.length === 0 && usuarios.length > 0">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron usuarios</h4>
    <p>Intenta ajustar los filtros de b√∫squeda</p>
  </div>

  <div class="empty-state" *ngIf="usuarios.length === 0">
    <div class="empty-icon">
      <ion-icon name="people-outline"></ion-icon>
    </div>
    <h4>No hay usuarios registrados</h4>
    <p>Los usuarios registrados aparecer√°n aqu√≠</p>
  </div>

</div>

<!-- ====================== -->
<!-- TAB: MENSAJES -->
<!-- ====================== -->
<div *ngIf="tabActiva === 'mensajes'" class="content-wrapper" data-tab="mensajes">
  
  <!-- Header -->
  <div class="content-header">
    <div>
      <h2>Mensajes Recibidos</h2>
      <p>Gestiona los mensajes de contacto del sistema</p>
    </div>
    <div class="header-actions">
      <button class="btn-export" (click)="exportarMensajesCSV()">
        <ion-icon name="download-outline"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Estad√≠sticas -->
  <div class="users-stats">
    <div class="stat-card-user">
      <div class="stat-icon-wrapper">
        <ion-icon name="mail-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ mensajes.length }}</span>
        <span class="stat-label">Total Mensajes</span>
      </div>
    </div>
    <div class="stat-card-user admin">
      <div class="stat-icon-wrapper">
        <ion-icon name="time-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ mensajesRecientes }}</span>
        <span class="stat-label">√öltimos 7 d√≠as</span>
      </div>
    </div>
    <div class="stat-card-user regular">
      <div class="stat-icon-wrapper">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ mensajesFiltrados.length }}</span>
        <span class="stat-label">Mostrados</span>
      </div>
    </div>
  </div>

  <!-- B√∫squeda r√°pida -->
  <div class="search-container-wrapper">
    <div class="form-group-custom search-group">
      <label class="form-label-custom">
        <ion-icon name="search-outline"></ion-icon>
        <span>B√∫squeda R√°pida</span>
      </label>
      <div class="input-wrapper">
        <input 
          type="text" 
          [(ngModel)]="filtroMensajeBusqueda"
          (ngModelChange)="aplicarFiltrosMensajes()"
          placeholder="Buscar por nombre, email o empresa..."
          class="custom-input">
        <button 
          *ngIf="filtroMensajeBusqueda" 
          class="btn-clear-search"
          (click)="limpiarFiltrosMensajes()"
          style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: none; background: rgba(237, 19, 112, 0.1); border-radius: 50%; cursor: pointer; transition: all 0.2s ease; margin-left: 8px;">
          <ion-icon name="close-circle" style="font-size: 24px; color: #ed1370;"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Filtros activos -->
  <div class="active-filters" *ngIf="filtroMensajeBusqueda">
    <div class="filter-header">
      <ion-icon name="filter-outline"></ion-icon>
      <span>Filtros activos (1):</span>
    </div>
    <div class="filter-tags">
      <div class="filter-tag">
        <span>B√∫squeda: {{ filtroMensajeBusqueda }}</span>
        <button (click)="limpiarFiltrosMensajes()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Grid de mensajes NUEVO - 4 columnas -->
  <div class="messages-grid-premium">
    <div *ngFor="let msg of mensajesFiltrados" class="message-card-premium">
      
      <!-- Header de la carta -->
      <div class="card-header-premium">
        <div class="avatar-circle">
          <ion-icon name="person-outline"></ion-icon>
        </div>
        <div class="header-info">
          <h3 class="sender-name-premium">{{ msg.name }}</h3>
          <span class="message-date">{{ msg.date | date:'short' }}</span>
        </div>
      </div>

      <!-- Contenido principal -->
      <div class="card-body-premium">
        
        <!-- Email -->
        <div class="info-row-premium">
          <div class="info-icon email">
            <ion-icon name="mail"></ion-icon>
          </div>
          <div class="info-content">
            <span class="info-label">Email</span>
            <a [href]="'mailto:' + msg.email" class="info-value">{{ msg.email }}</a>
          </div>
        </div>

        <!-- Tel√©fono -->
        <div class="info-row-premium" *ngIf="msg.phone">
          <div class="info-icon phone">
            <ion-icon name="call"></ion-icon>
          </div>
          <div class="info-content">
            <span class="info-label">Tel√©fono</span>
            <span class="info-value">{{ msg.phone }}</span>
          </div>
        </div>

        <!-- Empresa -->
        <div class="info-row-premium" *ngIf="msg.company">
          <div class="info-icon company">
            <ion-icon name="business"></ion-icon>
          </div>
          <div class="info-content">
            <span class="info-label">Empresa</span>
            <span class="info-value">{{ msg.company }}</span>
          </div>
        </div>

        <!-- Mensaje -->
        <div class="message-content-premium">
          <div class="message-icon-premium">
            <ion-icon name="chatbox-ellipses"></ion-icon>
          </div>
          <p class="message-text-premium">{{ msg.message }}</p>
        </div>

      </div>

      <!-- Footer con acciones -->
      <div class="card-footer-premium">
        <button class="btn-action-premium reply" (click)="responderMensaje(msg.email, msg.message)">
          <ion-icon name="arrow-undo"></ion-icon>
          <span>Responder</span>
        </button>
        <button class="btn-action-premium delete" (click)="eliminarMensaje(msg.id)">
          <ion-icon name="trash"></ion-icon>
        </button>
      </div>

    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div class="empty-state" *ngIf="mensajesFiltrados.length === 0 && mensajes.length > 0">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron mensajes</h4>
    <p>Intenta ajustar los filtros de b√∫squeda</p>
  </div>

  <div class="empty-state" *ngIf="mensajes.length === 0">
    <div class="empty-icon">
      <ion-icon name="mail-open-outline"></ion-icon>
    </div>
    <h4>No hay mensajes</h4>
    <p>Los mensajes de contacto aparecer√°n aqu√≠</p>
  </div>

</div>

<!-- ====================== -->
<!-- TAB: NEWSLETTER -->
<!-- ====================== -->
<div *ngIf="tabActiva === 'newsletter'" class="content-wrapper" data-tab="newsletter">
  
  <!-- Header -->
  <div class="content-header">
    <div>
      <h2>Gesti√≥n de Newsletter</h2>
      <p>Administra suscriptores y env√≠a boletines promocionales</p>
    </div>
    <div class="header-actions">
      <button 
        class="btn-send-newsletter" 
        (click)="abrirModalEnviarNewsletter()"
        [disabled]="suscriptores.length === 0 || suscriptoresSeleccionados.size === 0">
        <ion-icon name="send-outline"></ion-icon>
        <span>Enviar Newsletter</span>
      </button>
      <button class="btn-export" (click)="exportarSuscriptoresCSV()">
        <ion-icon name="download-outline"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Estad√≠sticas -->
  <div class="users-stats">
    <div class="stat-card-user">
      <div class="stat-icon-wrapper">
        <ion-icon name="people-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ suscriptores.length }}</span>
        <span class="stat-label">Total Suscriptores</span>
      </div>
    </div>
    <div class="stat-card-user admin">
      <div class="stat-icon-wrapper">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ suscriptoresFiltrados.length }}</span>
        <span class="stat-label">Mostrados</span>
      </div>
    </div>
    <div class="stat-card-user regular">
      <div class="stat-icon-wrapper">
        <ion-icon name="mail-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ suscriptoresSeleccionados.size }}</span>
        <span class="stat-label">Seleccionados</span>
      </div>
    </div>
  </div>

  <!-- B√∫squeda r√°pida -->
  <div class="search-container-wrapper">
    <div class="form-group-custom search-group">
      <label class="form-label-custom">
        <ion-icon name="search-outline"></ion-icon>
        <span>B√∫squeda R√°pida</span>
      </label>
      <div class="input-wrapper">
        <input 
          type="text" 
          [(ngModel)]="filtroEmailNewsletter"
          (ngModelChange)="aplicarFiltroNewsletter()"
          placeholder="Buscar por nombre o email..."
          class="custom-input">
        <button 
          *ngIf="filtroEmailNewsletter" 
          class="btn-clear-search"
          (click)="limpiarFiltroNewsletter()"
          style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: none; background: rgba(237, 19, 112, 0.1); border-radius: 50%; cursor: pointer; transition: all 0.2s ease; margin-left: 8px;">
          <ion-icon name="close-circle" style="font-size: 24px; color: #ed1370;"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Filtros activos -->
  <div class="active-filters" *ngIf="filtroEmailNewsletter">
    <div class="filter-header">
      <ion-icon name="filter-outline"></ion-icon>
      <span>Filtros activos (1):</span>
    </div>
    <div class="filter-tags">
      <div class="filter-tag">
        <span>B√∫squeda: {{ filtroEmailNewsletter }}</span>
        <button (click)="limpiarFiltroNewsletter()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de suscriptores -->
  <div class="users-table-container" *ngIf="suscriptoresFiltrados.length > 0">
    
    <div class="table-controls">
      <label class="checkbox-control">
        <input 
          type="checkbox" 
          [(ngModel)]="seleccionarTodos"
          (change)="toggleSeleccionarTodos()">
        <span>Seleccionar todos ({{ suscriptoresFiltrados.length }})</span>
      </label>
    </div>

    <div class="users-table">
      <table>
        <thead>
          <tr>
            <th width="40">‚úì</th>
            <th>Nombre</th>
            <th>Email</th>
            <th width="180">Fecha de Suscripci√≥n</th>
            <th width="110" style="text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let suscriptor of suscriptoresFiltrados">
            <td>
              <input 
                type="checkbox" 
                [checked]="suscriptoresSeleccionados.has(suscriptor.id)"
                (change)="toggleSuscriptorSeleccion(suscriptor.id)"
                style="width: 20px; height: 20px; cursor: pointer; accent-color: #ed1370;">
            </td>
            
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <ion-icon name="person-outline" style="font-size: 20px; color: #ed1370;"></ion-icon>
                <strong style="font-family: var(--font-primary); font-weight: 800; font-size: 0.95em; color: #27318d;">
                  {{ suscriptor.nombre }}
                </strong>
              </div>
            </td>
            
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <ion-icon name="mail-outline" style="font-size: 20px; color: #ed1370;"></ion-icon>
                <span style="font-size: 0.9em; color: #212529; font-family: var(--font-secondary);">
                  {{ suscriptor.email }}
                </span>
              </div>
            </td>
            
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <ion-icon name="calendar-outline" style="font-size: 18px; color: #6c757d;"></ion-icon>
                <span style="font-size: 0.85em; color: #6c757d; font-family: var(--font-secondary);">
                  {{ suscriptor.fechaSuscripcion | date:'short' }}
                </span>
              </div>
            </td>
            
            <td style="text-align: center;">
              <div class="table-actions">
                <button 
                  class="btn-icon-table danger" 
                  (click)="eliminarSuscriptor(suscriptor.id)"
                  title="Eliminar suscriptor">
                  <ion-icon name="trash-outline"></ion-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div class="empty-state" *ngIf="suscriptoresFiltrados.length === 0 && suscriptores.length > 0">
    <div class="empty-icon">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h4>No se encontraron suscriptores</h4>
    <p>Intenta ajustar los filtros de b√∫squeda</p>
  </div>

  <div class="empty-state" *ngIf="suscriptores.length === 0">
    <div class="empty-icon">
      <ion-icon name="newspaper-outline"></ion-icon>
    </div>
    <h4>No hay suscriptores</h4>
    <p>Los usuarios que se suscriban al newsletter aparecer√°n aqu√≠</p>
  </div>

</div>

    </div>
  </div>
</section>

<!-- üé® MODAL CONFIRMAR ELIMINACI√ìN UNIFICADO -->
<div class="modal-overlay" *ngIf="mostrarModalEliminar" (click)="cerrarModalEliminar()">
    <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon delete-icon">
              <ion-icon name="trash-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>¬øEliminar {{ obtenerTipoTexto() }}?</h2>
              <p>Esta acci√≥n no se puede deshacer</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalEliminar()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          <div class="delete-warning">
            <ion-icon name="warning-outline"></ion-icon>
            <div>
              <p><strong>{{ nombreElementoEliminar }}</strong></p>
              <p>{{ obtenerMensajeConfirmacion() }}</p>
            </div>
          </div>
        </div>

        <!-- üìò Botones -->
        <div class="modal-footer-custom">
          <button 
            type="button"
            (click)="cerrarModalEliminar()"
            class="btn-cancel">
            <ion-icon name="close-outline"></ion-icon>
            <span>Cancelar</span>
          </button>
          
          <button 
            type="button"
            (click)="confirmarEliminacion()"
            class="btn-delete">
            <ion-icon name="trash-outline"></ion-icon>
            <span>Eliminar</span>
          </button>
        </div>

      </div>
    </div>
</div>

<!-- üé® MODAL CONFIRMAR IMPORTACI√ìN CSV -->
<div class="modal-overlay" *ngIf="mostrarModalImportacion" (click)="cancelarImportacion()">
    <div class="modal-container import-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon import-icon">
              <ion-icon name="cloud-upload-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>¬øConfirmar Importaci√≥n?</h2>
              <p>Revisa los detalles antes de continuar</p>
            </div>
          </div>
          <button class="close-btn" (click)="cancelarImportacion()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          <div class="import-info">
            <ion-icon name="information-circle-outline"></ion-icon>
            <div>
              <p><strong>{{ cantidadImportar }} producto(s)</strong> ser√°n importados al sistema.</p>
              <p class="info-detail">Los productos con SKU existente se actualizar√°n autom√°ticamente.</p>
            </div>
          </div>
        </div>

        <!-- üìò Botones -->
        <div class="modal-footer-custom">
          <button 
            type="button"
            (click)="cancelarImportacion()"
            class="btn-cancel">
            <ion-icon name="close-outline"></ion-icon>
            <span>Cancelar</span>
          </button>
          
          <button 
            type="button"
            (click)="ejecutarImportacion()"
            class="btn-import">
            <ion-icon name="cloud-upload-outline"></ion-icon>
            <span>Importar</span>
          </button>
        </div>

      </div>
    </div>
</div>

<!-- üé® MODAL ENVIAR NEWSLETTER -->
<div class="modal-overlay" *ngIf="mostrarModalEnviarNewsletter" (click)="cerrarModalEnviarNewsletter()">
    <div class="modal-container newsletter-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="send-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Enviar Newsletter</h2>
              <p>Crea y env√≠a tu bolet√≠n promocional a los Suscriptores</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalEnviarNewsletter()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom newsletter-body">
          
          <!-- Alerta de destinatarios -->
          <div class="alert-box info" *ngIf="suscriptoresSeleccionados.size === 0">
            <ion-icon name="information-circle-outline"></ion-icon>
            <div>
              <strong>Selecciona destinatarios</strong>
              <p>Debes seleccionar al menos un suscriptor antes de enviar</p>
            </div>
          </div>

          <div class="alert-box success" *ngIf="suscriptoresSeleccionados.size > 0">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <div>
              <strong>Se han seleccionado <b>{{ suscriptoresSeleccionados.size }}</b> suscriptores.</strong>
              <p>El newsletter se enviar√° a estos suscriptores</p>
            </div>
          </div>

          <!-- üìù Formulario -->
          <form (ngSubmit)="enviarNewsletter()" #newsletterForm="ngForm">
            
            <!-- Asunto -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="text-outline"></ion-icon>
                <span>Asunto del correo</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="asuntoNewsletter" 
                  name="asunto" 
                  placeholder="Ej: ¬°Nuevas Ofertas Exclusivas! üéâ" 
                  required
                  maxlength="150"
                  class="custom-input">
              </div>
              <div class="input-hint">
                <ion-icon name="bulb-outline"></ion-icon>
                <span>Un asunto atractivo aumenta la tasa de apertura</span>
              </div>
            </div>

            <!-- Mensaje -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="document-text-outline"></ion-icon>
                <span>Contenido del Newsletter</span>
              </label>
              <div class="input-wrapper textarea-wrapper">
                <textarea 
                  [(ngModel)]="mensajeNewsletter" 
                  name="mensaje" 
                  placeholder="Escribe aqu√≠ tu mensaje promocional...

Ejemplo:
¬°Hola! üëã

Te tenemos excelentes noticias. Esta semana tenemos ofertas especiales en toda nuestra l√≠nea de productos desechables.

‚ú® 20% de descuento en vasos t√©rmicos
üéÅ Compra 2 y lleva 3 en platos biodegradables
üì¶ Env√≠o gratis en compras mayores a $500

¬°Aprovecha estas promociones antes de que terminen!

Saludos,
Equipo Interventas"
                  rows="12"
                  required
                  class="custom-textarea"></textarea>
              </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="submit"
                class="btn-submit"
                [disabled]="!newsletterForm.valid || suscriptoresSeleccionados.size === 0 || enviandoNewsletter">
                <span class="spinner" *ngIf="enviandoNewsletter"></span>
                <ion-icon *ngIf="!enviandoNewsletter" name="send-outline"></ion-icon>
                <span>{{ enviandoNewsletter ? 'Enviando...' : 'Enviar Newsletter' }}</span>
              </button>
              
              <button 
                type="button"
                (click)="cerrarModalEnviarNewsletter()"
                class="btn-cancel"
                [disabled]="enviandoNewsletter">
                <ion-icon name="close-outline"></ion-icon>
                <span>Cancelar</span>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
</div>

<!-- üé® MODAL AGREGAR/EDITAR PRODUCTO - OPCI√ìN 2: FLUJO DE TRABAJO -->
<div class="modal-overlay" *ngIf="mostrarModalProducto" (click)="cerrarModalProducto()">
  <div class="modal-container2 product-modal-large" (click)="$event.stopPropagation()">
    <div class="modal-wrapper">
      
      <!-- üéØ Header del Modal -->
      <div class="modal-header-custom2">
        <div class="header-left">
          <div class="header-icon">
            <ion-icon [name]="modoEdicion ? 'create-outline' : 'add-circle-outline'"></ion-icon>
          </div>
          <div class="header-text">
            <h2>{{ modoEdicion ? 'Editar Producto' : 'Agregar Producto' }}</h2>
            <p>{{ modoEdicion ? 'Actualiza la informaci√≥n del producto' : 'Completa los datos del nuevo producto' }}</p>
          </div>
        </div>
        <button class="close-btn" (click)="cerrarModalProducto()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- üìã Contenido del Modal -->
      <div class="modal-body-custom product-modal-body">
        <form (ngSubmit)="guardarProducto()" #productForm="ngForm">
          
          <!-- ========== GRID DE 2 COLUMNAS ========== -->
          <div class="product-form-grid">
            
            <!-- üìå COLUMNA IZQUIERDA: IDENTIFICACI√ìN Y PRESENTACI√ìN -->
            <div class="form-column form-column-left">
              
              <!-- 1Ô∏è‚É£ DATOS DE IDENTIDAD -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="finger-print-outline"></ion-icon>
                  <h3>Datos de Identidad</h3>
                </div>

                <!-- SKU -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="barcode-outline"></ion-icon>
                    <span>SKU</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.sku" 
                    name="sku" 
                    placeholder="Ej: POP500"
                    class="input-compact"
                    required>
                </div>

                <!-- Nombre -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="pricetag-outline"></ion-icon>
                    <span>Nombre del Producto</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.nombre" 
                    name="nombre" 
                    placeholder="Ej: Popote BIO Colores Neon" 
                    class="input-compact"
                    required>
                </div>

                <!-- Marca -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="ribbon-outline"></ion-icon>
                    <span>Marca</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.marca" 
                    name="marca" 
                    placeholder="Ej: Reyma"
                    class="input-compact"
                    required>
                </div>

                <!-- IMAGEN DEL PRODUCTO -->
                <div class="form-group-compact" style="margin-top: 20px;">
                  <label class="form-label-compact required">
                    <ion-icon name="image-outline"></ion-icon>
                    <span>Imagen del Producto</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.imagen" 
                    name="imagen" 
                    placeholder="https://ejemplo.com/imagen.jpg"
                    [disabled]="!tieneOpcionesValidas()"
                    required
                    class="input-compact">
                </div>

                <!-- Vista previa de imagen -->
                <div class="image-preview" *ngIf="producto.imagen && producto.imagen.trim() !== ''">
                  <div class="preview-label">
                    <ion-icon name="eye-outline"></ion-icon>
                    <span>Vista previa</span>
                  </div>
                  <div class="preview-box">
                    <img [src]="producto.imagen" alt="Preview" />
                  </div>
                </div>
              </div>

              <!-- 2Ô∏è‚É£ DESCRIPCI√ìN COMPLETA -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="document-text-outline"></ion-icon>
                  <h3>Descripci√≥n Completa</h3>
                </div>

                <!-- Descripci√≥n -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="create-outline"></ion-icon>
                    <span>Descripci√≥n del Producto</span>
                  </label>
                  <textarea 
                    [(ngModel)]="producto.descripcion" 
                    name="descripcion" 
                    placeholder="Describe las caracter√≠sticas principales del producto..."
                    rows="5"
                    [disabled]="!tieneOpcionesValidas()"
                    required
                    class="textarea-compact"></textarea>
                </div>

                <!-- Usos Recomendados -->
                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="bulb-outline"></ion-icon>
                    <span>Usos Recomendados</span>
                  </label>
                  <textarea 
                    [(ngModel)]="producto.usosRecomendados" 
                    name="usosRecomendados" 
                    placeholder="Ej: Ideal para eventos, fiestas, restaurantes..."
                    rows="4"
                    [disabled]="!tieneOpcionesValidas()"
                    class="textarea-compact"></textarea>
                </div>
              </div>

              <!-- 3Ô∏è‚É£ CLASIFICACI√ìN -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="folder-outline"></ion-icon>
                  <h3>Clasificaci√≥n</h3>
                </div>

                <!-- Categor√≠a -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="apps-outline"></ion-icon>
                    <span>Categor√≠a</span>
                  </label>
                  <div class="select-wrapper-compact">
                    <select 
                      [(ngModel)]="producto.categoria" 
                      (ngModelChange)="onCategoriaChange()"
                      name="categoria" 
                      class="select-compact"
                      required>
                      <option value="" disabled selected>Seleccionar categor√≠a</option>
                      <option value="Desechables">Desechables</option>
                      <option value="Biodegradables">Biodegradables</option>
                      <option value="Bolsas">Bolsas</option>
                      <option value="Cocina y Reposter√≠a">Cocina y Reposter√≠a</option>
                      <option value="Alimentos">Alimentos</option>
                      <option value="Higi√©nicos y Servilletas">Higi√©nicos y Servilletas</option>
                    </select>
                    <ion-icon name="chevron-down-outline"></ion-icon>
                  </div>
                </div>

                <!-- Subcategor√≠a -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="layers-outline"></ion-icon>
                    <span>Subcategor√≠a</span>
                  </label>
                  <div class="select-wrapper-compact" [class.disabled]="!producto.categoria">
                    <select 
                      [(ngModel)]="producto.subcategoria" 
                      name="subcategoria" 
                      class="select-compact"
                      [disabled]="!producto.categoria"
                      required>
                      <option value="" disabled selected>
                        {{ producto.categoria ? 'Seleccionar subcategor√≠a' : 'Selecciona categor√≠a primero' }}
                      </option>
                      <option *ngFor="let sub of subcategorias" [value]="sub">{{ sub }}</option>
                    </select>
                    <ion-icon name="chevron-down-outline"></ion-icon>
                  </div>
                </div>
              </div>
            </div>

            <!-- üìå COLUMNA DERECHA: COMERCIALIZACI√ìN -->
            <div class="form-column form-column-right">
              
              <!-- 1Ô∏è‚É£ ESPECIFICACIONES DEL PRODUCTO -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="construct-outline"></ion-icon>
                  <h3>Especificaciones del Producto</h3>
                </div>

                <!-- Material -->
                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="albums-outline"></ion-icon>
                    <span>Material</span>
                  </label>
                  <div class="select-wrapper-compact">
                    <select 
                      [(ngModel)]="producto.material" 
                      name="material" 
                      class="select-compact">
                      <option value="">Seleccionar material</option>
                      <option value="Pl√°stico">Pl√°stico</option>
                      <option value="Papel">Papel</option>
                      <option value="Biodegradable">Biodegradable</option>
                      <option value="Cart√≥n">Cart√≥n</option>
                      <option value="Aluminio">Aluminio</option>
                      <option value="Madera">Madera</option>
                      <option value="PET">PET</option>
                      <option value="Polietileno">Polietileno</option>
                      <option value="Polipropileno">Polipropileno</option>
                      <option value="Otro">Otro</option>
                    </select>
                    <ion-icon name="chevron-down-outline"></ion-icon>
                  </div>
                </div>

                <!-- Color -->
                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="color-palette-outline"></ion-icon>
                    <span>Color</span>
                  </label>
                  <div class="select-wrapper-compact">
                    <select 
                      [(ngModel)]="producto.color" 
                      name="color" 
                      class="select-compact">
                      <option value="">Seleccionar color</option>
                      <option value="Blanco">Blanco</option>
                      <option value="Transparente">Transparente</option>
                      <option value="Negro">Negro</option>
                      <option value="Kraft">Kraft</option>
                      <option value="Rojo">Rojo</option>
                      <option value="Azul">Azul</option>
                      <option value="Verde">Verde</option>
                      <option value="Amarillo">Amarillo</option>
                      <option value="Multicolor">Multicolor</option>
                      <option value="Otro">Otro</option>
                    </select>
                    <ion-icon name="chevron-down-outline"></ion-icon>
                  </div>
                </div>

                <!-- Medida/Capacidad -->
                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="resize-outline"></ion-icon>
                    <span>Medida/Capacidad</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.medida" 
                    name="medida" 
                    placeholder="Ej: 16oz, 500ml, 30cm"
                    class="input-compact">
                </div>

                <!-- Cantidad por Paquete -->
                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="cube-outline"></ion-icon>
                    <span>Cantidad por Paquete</span>
                  </label>
                  <input 
                    type="text" 
                    [(ngModel)]="producto.cantidadPaquete" 
                    name="cantidadPaquete" 
                    placeholder="Ej: Caja de 1000 pzas"
                    class="input-compact">
                </div>

                <!-- Caracter√≠sticas Especiales -->
                <div class="form-group-compact" style="margin-top: 16px;">
                  <label class="form-label-compact">
                    <ion-icon name="checkmark-circle-outline"></ion-icon>
                    <span>Caracter√≠sticas Especiales</span>
                  </label>
                  <div class="caracteristicas-compact">
                    <label class="checkbox-compact">
                      <input 
                        type="checkbox" 
                        [(ngModel)]="producto.biodegradable" 
                        name="biodegradable">
                      <span>Biodegradable</span>
                    </label>

                    <label class="checkbox-compact">
                      <input 
                        type="checkbox" 
                        [(ngModel)]="producto.aptoMicroondas" 
                        name="aptoMicroondas">
                      <span>Apto Microondas</span>
                    </label>

                    <label class="checkbox-compact">
                      <input 
                        type="checkbox" 
                        [(ngModel)]="producto.aptoCongelador" 
                        name="aptoCongelador">
                      <span>Apto Congelador</span>
                    </label>

                    <label class="checkbox-compact checkbox-destacado">
                      <input 
                        type="checkbox" 
                        [(ngModel)]="producto.destacado" 
                        name="destacado">
                      <span>‚≠ê Destacado</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- 2Ô∏è‚É£ MODALIDADES DE VENTA -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="cart-outline"></ion-icon>
                  <h3>Modalidades de Venta</h3>
                </div>

                <!-- Seleccionar Modalidad -->
                <div class="form-group-compact">
                  <label class="form-label-compact required">
                    <ion-icon name="list-outline"></ion-icon>
                    <span>Agregar Modalidad</span>
                  </label>
                  <div class="modalidad-select-inline">
                    <div class="select-wrapper-compact">
                      <select 
                        [(ngModel)]="modalidadSeleccionada" 
                        name="modalidadSeleccionada" 
                        class="select-compact">
                        <option value="" disabled selected>Seleccionar</option>
                        <option value="Menudeo">Menudeo</option>
                        <option value="Mayoreo">Mayoreo</option>
                      </select>
                      <ion-icon name="chevron-down-outline"></ion-icon>
                    </div>
                    <button 
                      *ngIf="modalidadSeleccionada"
                      type="button" 
                      class="btn-clear-inline"
                      (click)="limpiarModalidadSeleccionada()">
                      <ion-icon name="close-outline"></ion-icon>
                    </button>
                  </div>
                </div>

                <!-- Formulario para agregar opciones -->
                <div class="add-option-box" *ngIf="!!modalidadSeleccionada">
                  <div class="option-form-header">
                    <ion-icon name="add-circle-outline"></ion-icon>
                    <span>Nueva opci√≥n de {{ modalidadSeleccionada }}</span>
                  </div>

                  <div class="form-group-compact">
                    <label class="form-label-compact required">
                      <ion-icon name="cash-outline"></ion-icon>
                      <span>Precio</span>
                    </label>
                    <div class="input-with-prefix">
                      <span class="input-prefix">$</span>
                      <input 
                        type="number" 
                        [(ngModel)]="precioActual" 
                        name="precioActual" 
                        placeholder="0.00" 
                        min="0"
                        step="0.01"
                        class="input-compact input-with-prefix-field">
                    </div>
                  </div>

                  <div class="form-group-compact">
                    <label class="form-label-compact">
                      <ion-icon name="resize-outline"></ion-icon>
                      <span>Tama√±o</span>
                    </label>
                    <input 
                      type="text" 
                      [(ngModel)]="tamanoActual" 
                      name="tamanoActual" 
                      placeholder="Ej: 16oz, Grande"
                      class="input-compact">
                  </div>

                  <div class="form-group-compact">
                    <label class="form-label-compact">
                      <ion-icon name="layers-outline"></ion-icon>
                      <span>Contenido</span>
                    </label>
                    <input 
                      type="text" 
                      [(ngModel)]="contenidoActual" 
                      name="contenidoActual" 
                      placeholder="Ej: Caja de 100"
                      class="input-compact">
                  </div>

                  <button 
                    type="button" 
                    class="btn-add-option"
                    (click)="agregarOpcionModalidad()">
                    <ion-icon name="add-circle-outline"></ion-icon>
                    <span>Agregar Opci√≥n</span>
                  </button>
                </div>

                <!-- Opciones de Menudeo -->
                <div class="options-display-section">
                  <div class="options-section-title">
                    <ion-icon name="cart-outline"></ion-icon>
                    <span>Menudeo</span>
                  </div>
                  
                  <div class="options-list" *ngIf="obtenerOpcionesModalidad('Menudeo').length > 0">
                    <div class="option-item" *ngFor="let opcion of obtenerOpcionesModalidad('Menudeo')">
                      <div class="option-details">
                        <span class="option-price">${{ opcion.precio }}</span>
                        <span class="option-info">Tama√±o: {{ opcion.tamano }} | Contenido: {{ opcion.contenido }}</span>
                      </div>
                      <button 
                        type="button" 
                        class="btn-remove-option"
                        (click)="eliminarOpcionModalidad(opcion.id)">
                        <ion-icon name="trash-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  
                  <div class="empty-options" *ngIf="obtenerOpcionesModalidad('Menudeo').length === 0">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <span>No hay opciones de Menudeo</span>
                  </div>
                </div>

                <!-- Opciones de Mayoreo -->
                <div class="options-display-section">
                  <div class="options-section-title">
                    <ion-icon name="cart-outline"></ion-icon>
                    <span>Mayoreo</span>
                  </div>
                  
                  <div class="options-list" *ngIf="obtenerOpcionesModalidad('Mayoreo').length > 0">
                    <div class="option-item" *ngFor="let opcion of obtenerOpcionesModalidad('Mayoreo')">
                      <div class="option-details">
                        <span class="option-price">${{ opcion.precio }}</span>
                        <span class="option-info">{{ opcion.tamano }} | {{ opcion.contenido }}</span>
                      </div>
                      <button 
                        type="button" 
                        class="btn-remove-option"
                        (click)="eliminarOpcionModalidad(opcion.id)">
                        <ion-icon name="trash-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  
                  <div class="empty-options" *ngIf="obtenerOpcionesModalidad('Mayoreo').length === 0">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <span>No hay opciones de Mayoreo</span>
                  </div>
                </div>
              </div>

              <!-- 3Ô∏è‚É£ DISTRIBUCI√ìN - SUCURSALES -->
              <div class="form-section-card">
                <div class="section-header">
                  <ion-icon name="storefront-outline"></ion-icon>
                  <h3>Distribuci√≥n</h3>
                </div>

                <div class="form-group-compact">
                  <label class="form-label-compact">
                    <ion-icon name="location-outline"></ion-icon>
                    <span>Sucursales Disponibles</span>
                  </label>

                  <div class="tiendas-list" *ngIf="producto.tiendas && producto.tiendas.length > 0">
                    <div class="tienda-item" *ngFor="let tienda of producto.tiendas; let i = index">
                      <ion-icon name="location-outline"></ion-icon>
                      <span>{{ tienda }}</span>
                      <button 
                        type="button" 
                        class="btn-remove-tienda"
                        (click)="eliminarTienda(i)"
                        [disabled]="!tieneOpcionesValidas()">
                        <ion-icon name="close-outline"></ion-icon>
                      </button>
                    </div>
                  </div>

                  <div class="add-tienda-wrapper">
                    <input 
                      type="text" 
                      [(ngModel)]="nuevaTienda" 
                      name="nuevaTienda" 
                      placeholder="Nombre de sucursal"
                      (keyup.enter)="agregarTienda()"
                      [disabled]="!tieneOpcionesValidas()"
                      class="input-compact">
                    <button 
                      type="button" 
                      class="btn-add-tienda" 
                      (click)="agregarTienda()"
                      [disabled]="!tieneOpcionesValidas()">
                      <ion-icon name="add-outline"></ion-icon>
                    </button>
                  </div>

                  <div class="hint-text" *ngIf="!tieneOpcionesValidas()">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <span>Agrega opciones de venta primero</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== BOTONES DE ACCI√ìN ========== -->
          <div class="modal-footer-actions2">
            <button 
              type="submit"
              class="btn-submit-product"
              [disabled]="!producto.sku || !producto.sku.trim() ||
                          !producto.nombre || !producto.nombre.trim() || 
                          !producto.categoria || !producto.categoria.trim() ||
                          !producto.subcategoria || !producto.subcategoria.trim() ||
                          !producto.marca || !producto.marca.trim() ||
                          !producto.descripcion || !producto.descripcion.trim() ||
                          !producto.imagen || !producto.imagen.trim() ||
                          !tieneOpcionesValidas()">
              <ion-icon [name]="modoEdicion ? 'checkmark-outline' : 'add-circle-outline'"></ion-icon>
              <span>{{ modoEdicion ? 'Actualizar Producto' : 'Agregar Producto' }}</span>
            </button>
            
            <button 
              type="button"
              (click)="cerrarModalProducto()"
              class="btn-cancel-product">
              <ion-icon name="close-outline"></ion-icon>
              <span>Cancelar</span>
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- üé® MODAL EDITAR USUARIO -->
<div class="modal-overlay" *ngIf="mostrarModalUsuario" (click)="cerrarModalUsuario()">
    <div class="modal-container user-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="create-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Editar Usuario</h2>
              <p>Actualiza la informaci√≥n del usuario</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalUsuario()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          <!-- üìù Formulario -->
          <form (ngSubmit)="guardarUsuarioEditado(usuarioEditandoId)" #userForm="ngForm">
            
            <!-- Nombre -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="person-outline"></ion-icon>
                <span>Nombre Completo</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="usuarioEditando.nombre" 
                  name="nombre" 
                  placeholder="Ingresa el nombre completo" 
                  required
                  class="custom-input"
                  [value]="usuarioEditando.nombre">
              </div>
              <small>Valor actual: {{ usuarioEditando.nombre }}</small>
            </div>

            <!-- Email -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="mail-outline"></ion-icon>
                <span>Correo Electr√≥nico</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="email" 
                  [(ngModel)]="usuarioEditando.email" 
                  name="email" 
                  placeholder="ejemplo@correo.com" 
                  required
                  class="custom-input"
                  [value]="usuarioEditando.email">
              </div>
              <div class="input-hint">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>El correo debe ser v√°lido y √∫nico</span>
              </div>
              <small>Valor actual: {{ usuarioEditando.email }}</small>
            </div>

            <!-- Rol -->
            <div class="form-group-custom">
              <label class="form-label-custom required">
                <ion-icon name="shield-checkmark-outline"></ion-icon>
                <span>Rol del Usuario</span>
              </label>
              <div class="input-wrapper select-custom-wrapper">
                <select 
                  [(ngModel)]="usuarioEditando.rol" 
                  name="rol" 
                  class="custom-select-native"
                  [value]="usuarioEditando.rol">
                  <option value="usuario">Usuario</option>
                  <option value="admin">Administrador</option>
                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
              <div class="input-hint">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>Los administradores tienen acceso completo al sistema</span>
              </div>
              <small>Valor actual: {{ usuarioEditando.rol }}</small>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="submit"
                class="btn-submit"
                [disabled]="!userForm.valid">
                <ion-icon name="checkmark-outline"></ion-icon>
                <span>Guardar Cambios</span>
              </button>
              
              <button 
                type="button"
                (click)="cerrarModalUsuario()"
                class="btn-cancel">
                <ion-icon name="close-outline"></ion-icon>
                <span>Cancelar</span>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
</div>

<!-- üîç MODAL DE B√öSQUEDA DE USUARIOS -->
<div class="modal-overlay" *ngIf="mostrarModalBusquedaUsuarios" (click)="cerrarModalBusquedaUsuarios()">
  <div class="modal-container search-modal" (click)="$event.stopPropagation()">
    <div class="modal-wrapper">
      
      <!-- üéØ Header del Modal -->
      <div class="modal-header-custom">
        <div class="header-left">
          <div class="header-icon">
            <ion-icon name="search-outline"></ion-icon>
          </div>
          <div class="header-text">
            <h2>Buscar Usuarios</h2>
            <p>Filtra usuarios por nombre, email o rol</p>
          </div>
        </div>
        <button class="close-btn" (click)="cerrarModalBusquedaUsuarios()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- üìã Contenido del Modal -->
      <div class="modal-body-custom">
        
        <!-- üîé Formulario de B√∫squeda -->
        <div class="search-form">
          
          <!-- Nombre -->
          <div class="form-group-custom">
            <label class="form-label-custom">
              <ion-icon name="person-outline"></ion-icon>
              <span>Nombre del Usuario</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="filtroNombreUsuario" 
                name="filtroNombreUsuario" 
                placeholder="Ej: Juan, Mar√≠a, Carlos..."
                class="custom-input">
              <button 
                *ngIf="filtroNombreUsuario" 
                class="clear-input-btn" 
                (click)="filtroNombreUsuario = ''">
                <ion-icon name="close-circle"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Email -->
          <div class="form-group-custom" style="margin-top: 10px;">
            <label class="form-label-custom">
              <ion-icon name="mail-outline"></ion-icon>
              <span>Correo Electr√≥nico</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="filtroEmailUsuario" 
                name="filtroEmailUsuario" 
                placeholder="Ej: usuario@ejemplo.com"
                class="custom-input">
              <button 
                *ngIf="filtroEmailUsuario" 
                (click)="filtroEmailUsuario = ''">
                <ion-icon name="close-circle"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Rol -->
          <div class="form-group-custom" style="margin-top: 10px;">
            <label class="form-label-custom">
              <ion-icon name="shield-outline"></ion-icon>
              <span>Rol</span>
            </label>
            <div class="input-wrapper select-custom-wrapper">
              <select 
                [(ngModel)]="filtroRolUsuario" 
                name="filtroRolUsuario" 
                class="custom-select-native">
                <option value="">Todos los roles</option>
                <option value="usuario">Usuario</option>
                <option value="admin">Administrador</option>
              </select>
              <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
            </div>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="modal-footer-custom">
            <button 
              type="button"
              (click)="aplicarFiltrosUsuariosDesdeModal()"
              class="btn-submit">
              <ion-icon name="search-outline"></ion-icon>
              <span>Buscar</span>
            </button>
            
            <button 
              type="button"
              (click)="limpiarFiltrosUsuarios()"
              class="btn-cancel">
              <ion-icon name="refresh-outline"></ion-icon>
              <span>Limpiar Filtros</span>
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- üîç MODAL DE B√öSQUEDA DE PRODUCTOS-->
<div class="modal-overlay" *ngIf="mostrarModalBusqueda" (click)="cerrarModalBusqueda()">
    <div class="modal-container search-modal" (click)="$event.stopPropagation()">
      <div class="modal-wrapper">
        
        <!-- üéØ Header del Modal -->
        <div class="modal-header-custom">
          <div class="header-left">
            <div class="header-icon">
              <ion-icon name="search-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Buscar Productos</h2>
              <p>Filtra productos por nombre, SKU, marca, categor√≠a o subcategor√≠a</p>
            </div>
          </div>
          <button class="close-btn" (click)="cerrarModalBusqueda()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <!-- üìã Contenido del Modal -->
        <div class="modal-body-custom">
          
          <!-- üîé Formulario de B√∫squeda -->
          <div class="search-form">
            
            <!-- Nombre y SKU en una fila -->
            <div class="form-row-2col">
              <!-- Nombre -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="pricetag-outline"></ion-icon>
                  <span>Nombre del Producto</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    [(ngModel)]="filtroNombre" 
                    name="filtroNombre" 
                    placeholder="Ej: Vaso, Plato, etc."
                    class="custom-input">
                  <button 
                    *ngIf="filtroNombre" 
                    class="clear-input-btn" 
                    (click)="filtroNombre = ''">
                    <ion-icon name="close-circle"></ion-icon>
                  </button>
                </div>
              </div>

              <!-- SKU -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="barcode-outline"></ion-icon>
                  <span>SKU</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    [(ngModel)]="filtroSku" 
                    name="filtroSku" 
                    placeholder="Ej: VSO-TERM-16OZ"
                    class="custom-input">
                  <button 
                    *ngIf="filtroSku" 
                    class="clear-input-btn" 
                    (click)="filtroSku = ''">
                    <ion-icon name="close-circle"></ion-icon>
                  </button>
                </div>
              </div>
            </div>

            <!-- Marca -->
            <div class="form-group-custom">
              <label class="form-label-custom">
                <ion-icon name="ribbon-outline"></ion-icon>
                <span>Marca</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  [(ngModel)]="filtroMarca" 
                  name="filtroMarca" 
                  placeholder="Ej: Dart, Karat, Solo, etc."
                  class="custom-input">
                <button 
                  *ngIf="filtroMarca" 
                  class="clear-input-btn" 
                  (click)="filtroMarca = ''">
                  <ion-icon name="close-circle"></ion-icon>
                </button>
              </div>
            </div>

            <!-- Categor√≠a y Subcategor√≠a en una fila -->
            <div class="form-row-2col" style="margin-top: 10px;">
              <!-- Categor√≠a -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="folder-outline"></ion-icon>
                  <span>Categor√≠a</span>
                </label>
                <div class="input-wrapper select-custom-wrapper">
                  <select 
                    [(ngModel)]="filtroCategoria" 
                    (ngModelChange)="onFiltroCategoriaChange()"
                    name="filtroCategoria" 
                    class="custom-select-native">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Desechables">Desechables</option>
                    <option value="Biodegradables">Biodegradables</option>
                    <option value="Bolsas">Bolsas</option>
                    <option value="Cocina y Reposter√≠a">Cocina y Reposter√≠a</option>
                    <option value="Alimentos">Alimentos</option>
                    <option value="Higi√©nicos y Servilletas">Higi√©nicos y Servilletas</option>
                  </select>
                  <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
                </div>
              </div>

              <!-- Subcategor√≠a -->
              <div class="form-group-custom">
                <label class="form-label-custom">
                  <ion-icon name="layers-outline"></ion-icon>
                  <span>Subcategor√≠a</span>
                </label>
                <div class="input-wrapper select-custom-wrapper" [class.disabled]="!filtroCategoria">
                  <select 
                    [(ngModel)]="filtroSubcategoria" 
                    name="filtroSubcategoria" 
                    class="custom-select-native"
                    [disabled]="!filtroCategoria">
                    <option value="">
                      {{ filtroCategoria ? 'Todas las subcategor√≠as' : 'Selecciona una categor√≠a primero' }}
                    </option>
                    <option *ngFor="let sub of subcategoriasFiltro" [value]="sub">{{ sub }}</option>
                  </select>
                  <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
                </div>
              </div>
            </div>

            <!-- ‚≠ê Productos Destacados -->
            <div class="form-group-custom" style="margin-top: 16px;">
              <label class="form-label-custom">
                <ion-icon name="star-outline"></ion-icon>
                <span>Mostrar Productos</span>
              </label>
              <div class="input-wrapper select-custom-wrapper">
                <select 
                  [(ngModel)]="filtroDestacado" 
                  name="filtroDestacado" 
                  class="custom-select-native">
                  <option value="">Todos</option>
                  <option value="si">Solo Destacados</option>
                  <option value="no">No Destacados</option>
                </select>
                <ion-icon name="chevron-down-outline" class="select-arrow"></ion-icon>
              </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="modal-footer-custom">
              <button 
                type="button"
                (click)="aplicarFiltros()"
                class="btn-submit">
                <ion-icon name="search-outline"></ion-icon>
                <span>Buscar</span>
              </button>
              
              <button 
                type="button"
                (click)="limpiarTodosFiltros()"
                class="btn-cancel">
                <ion-icon name="refresh-outline"></ion-icon>
                <span>Limpiar Filtros</span>
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
</div>

</ion-content>