<ion-header>
  <ion-toolbar class="modern-toolbar">
    
    <!-- Contenedor Principal con Flex Mejorado -->
    <div class="header-container">
      
      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-wrapper" routerLink="/home">
          <img class="logo-img" src="../../assets/img/logo.png" alt="Logo Interventas">
          <div class="logo-glow"></div>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <ion-button 
          fill="clear" 
          class="nav-link" 
          routerLink="/home" 
          [class.active]="isHomeActive()">
          <span class="link-text">Inicio</span>
          <div class="link-underline"></div>
        </ion-button>

        <div class="nav-dropdown">
          <ion-button 
            fill="clear" 
            class="nav-link" 
            (click)="toggleDropdown('nosotros', $event)"
            [class.active]="isNosotrosActive()">
            <span class="link-text">Nosotros</span>
            <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
            <div class="link-underline"></div>
          </ion-button>
        </div>

        <div class="nav-dropdown">
          <ion-button 
            fill="clear" 
            class="nav-link" 
            (click)="toggleDropdown('productos', $event)"
            [class.active]="isProductosActive()">
            <span class="link-text">Productos</span>
            <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
            <div class="link-underline"></div>
          </ion-button>
        </div>

        <ion-button 
          fill="clear" 
          class="nav-link" 
          routerLink="/sucursales"
          [class.active]="isSucursalesActive()">
          <span class="link-text">Sucursales</span>
          <div class="link-underline"></div>
        </ion-button>
      </nav>

      <!-- Actions Section -->
      <div class="actions-section">

        <!-- Admin Panel Button (Solo visible para admins) -->
        <ion-button 
          *ngIf="isAdmin" 
          fill="clear" 
          class="action-btn admin-btn" 
          routerLink="/admin"
          [class.active]="isAdminActive()">
          <ion-icon [icon]="shieldCheckmarkOutline" class="action-icon"></ion-icon>
          <span class="admin-label">    Administración</span>
        </ion-button>

<!-- Cart Button -->
<ion-button fill="clear" class="action-btn cart-btn" routerLink="/carrito" [class.active]="isCartActive()">
  <div class="cart-wrapper">
    <ion-icon [icon]="cartOutline" class="action-icon"></ion-icon>
    <span class="cart-count-side" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
  </div>
</ion-button>

        <!-- User Section -->
        <div class="user-section">
          <!-- Not Logged In -->
          <ng-container *ngIf="!user">
            <ion-button class="login-btn" routerLink="/login">
              <ion-icon [icon]="logInOutline" slot="start"></ion-icon>
              <span>Iniciar Sesión</span>
            </ion-button>
          </ng-container>

          <!-- Logged In -->
          <ng-container *ngIf="user">
            <ion-button fill="clear" class="profile-btn" (click)="toggleProfileMenu()">
              <ion-icon [icon]="personCircleOutline" class="profile-icon"></ion-icon>
            </ion-button>
          </ng-container>
        </div>

        <!-- Mobile Menu Button -->
        <ion-button fill="clear" class="mobile-menu-btn" (click)="toggleMenu()">
          <ion-icon [icon]="menuOutline" class="mobile-icon"></ion-icon>
        </ion-button>
      </div>

    </div>

    <!-- Gradient Border Bottom -->
    <div class="gradient-border"></div>

  </ion-toolbar>

  <!-- ========================================== -->
  <!-- DROPDOWN NOSOTROS -->
  <!-- ========================================== -->
  <div class="modern-dropdown" 
       *ngIf="showNosotrosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    <div class="dropdown-header">
      <h3>Nosotros</h3>
    </div>
    <div class="dropdown-content">
      <a class="dropdown-link" routerLink="/nosotros/contacto" (click)="closeMenu()">
        <ion-icon name="mail-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Contacto</span>
          <span class="link-desc">Ponte en contacto con nosotros</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/nosotros/informacion" (click)="closeMenu()">
        <ion-icon name="information-circle-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Información</span>
          <span class="link-desc">Conoce más sobre nosotros</span>
        </div>
      </a>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- DROPDOWN PRODUCTOS -->
  <!-- ========================================== -->
  <div class="modern-dropdown" 
       *ngIf="showProductosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    <div class="dropdown-header">
      <h3>Nuestros Productos</h3>
    </div>
    <div class="dropdown-content">
      <a class="dropdown-link" routerLink="/productos/todos" (click)="closeMenu()">
        <ion-icon name="grid-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Todos los Productos</span>
          <span class="link-desc">Explora nuestro catálogo de productos destacados</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/desechables" (click)="closeMenu()">
        <ion-icon name="cafe-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Desechables</span>
          <span class="link-desc">Vasos, platos y cubiertos</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/biodegradables" (click)="closeMenu()">
        <ion-icon name="leaf-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Biodegradables</span>
          <span class="link-desc">Productos eco-friendly</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/bolsas" (click)="closeMenu()">
        <ion-icon name="bag-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Bolsas</span>
          <span class="link-desc">Para todo tipo de uso</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/cocina-reposteria" (click)="closeMenu()">
        <ion-icon name="restaurant-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Cocina y Repostería</span>
          <span class="link-desc">Utensilios y accesorios</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/alimentos" (click)="closeMenu()">
        <ion-icon name="pizza-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Alimentos</span>
          <span class="link-desc">Productos alimenticios</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">
        <ion-icon name="water-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Higiénicos y Servilletas</span>
          <span class="link-desc">Papel y productos de limpieza</span>
        </div>
      </a>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- PROFILE MENU -->
  <!-- ========================================== -->
  <div class="profile-dropdown" *ngIf="showProfileMenu && user">
    <div class="profile-header">
      <ion-icon [icon]="personCircleOutline" class="profile-avatar"></ion-icon>
      <div class="profile-info">
        <span class="profile-greeting">¡Hola!</span>
        <span class="profile-name">{{ user.displayName || user.email }}</span>
      </div>
    </div>
    <div class="profile-divider"></div>
    <ion-button expand="block" class="logout-button" (click)="logout()">
      <ion-icon [icon]="logOutOutline" slot="start"></ion-icon>
      <span>Cerrar Sesión</span>
    </ion-button>
  </div>

  <!-- ========================================== -->
  <!-- MOBILE SIDEBAR MENU -->
  <!-- ========================================== -->
  <div class="mobile-sidebar" [class.open]="showMobileMenu">
    <div class="sidebar-overlay" (click)="closeMenu()"></div>
    
    <div class="sidebar-content">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <img class="sidebar-logo" src="../../assets/img/logo.png" alt="Logo">
        <ion-button fill="clear" class="close-btn" (click)="closeMenu()">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- Dentro del sidebar-nav, después del link de Sucursales -->
<a class="sidebar-link" routerLink="/carrito" [class.active]="isCartActive()" (click)="closeMenu()">
  <ion-icon name="cart-outline" class="sidebar-icon"></ion-icon>
  <span>Carrito</span>
  <span class="cart-badge-mobile" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
</a>

      <!-- User Info Mobile -->
      <div class="sidebar-user" *ngIf="user">
        <ion-icon [icon]="personCircleOutline" class="sidebar-avatar"></ion-icon>
        <div class="sidebar-user-info">
          <span class="sidebar-greeting">Bienvenido</span>
          <span class="sidebar-name">{{ user.displayName || user.email }}</span>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <nav class="sidebar-nav">
        <!-- Admin Link (Solo visible para admins) -->
        <a 
          *ngIf="isAdmin" 
          class="sidebar-link admin-link" 
          routerLink="/admin" 
          [class.active]="isAdminActive()" 
          (click)="closeMenu()">
          <ion-icon name="shield-checkmark-outline" class="sidebar-icon"></ion-icon>
          <span>Panel de Administración</span>
        </a>

        <a class="sidebar-link" routerLink="/home" [class.active]="isHomeActive()" (click)="closeMenu()">
          <ion-icon name="home-outline" class="sidebar-icon"></ion-icon>
          <span>Inicio</span>
        </a>

        <div class="sidebar-dropdown">
          <button class="sidebar-link dropdown-trigger" (click)="toggleDropdown('nosotros', $event)" [class.active]="isNosotrosActive()">
            <ion-icon name="people-outline" class="sidebar-icon"></ion-icon>
            <span>Nosotros</span>
            <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showNosotrosDropdown"></ion-icon>
          </button>
          <div class="sidebar-submenu" *ngIf="showNosotrosDropdown">
            <a routerLink="/nosotros/contacto" (click)="closeMenu()">Contacto</a>
            <a routerLink="/nosotros/informacion" (click)="closeMenu()">Información</a>
          </div>
        </div>

        <div class="sidebar-dropdown">
          <button class="sidebar-link dropdown-trigger" (click)="toggleDropdown('productos', $event)" [class.active]="isProductosActive()">
            <ion-icon name="cube-outline" class="sidebar-icon"></ion-icon>
            <span>Productos</span>
            <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showProductosDropdown"></ion-icon>
          </button>
          <div class="sidebar-submenu" *ngIf="showProductosDropdown">
            <a routerLink="/productos/todos" (click)="closeMenu()">Todos los productos</a>
            <a routerLink="/productos/desechables" (click)="closeMenu()">Desechables</a>
            <a routerLink="/productos/biodegradables" (click)="closeMenu()">Biodegradables</a>
            <a routerLink="/productos/bolsas" (click)="closeMenu()">Bolsas</a>
            <a routerLink="/productos/cocina-reposteria" (click)="closeMenu()">Cocina y Repostería</a>
            <a routerLink="/productos/alimentos" (click)="closeMenu()">Alimentos</a>
            <a routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">Higiénicos y Servilletas</a>
          </div>
        </div>

        <a class="sidebar-link" routerLink="/sucursales" [class.active]="isSucursalesActive()" (click)="closeMenu()">
          <ion-icon name="location-outline" class="sidebar-icon"></ion-icon>
          <span>Sucursales</span>
        </a>
      </nav>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer">
        <ng-container *ngIf="!user">
          <ion-button expand="block" class="sidebar-login-btn" routerLink="/login" (click)="closeMenu()">
            <ion-icon [icon]="logInOutline" slot="start"></ion-icon>
            <span>Iniciar Sesión</span>
          </ion-button>
        </ng-container>

        <ng-container *ngIf="user">
          <ion-button expand="block" color="danger" class="sidebar-logout-btn" (click)="logout()">
            <ion-icon [icon]="logOutOutline" slot="start"></ion-icon>
            <span>Cerrar Sesión</span>
          </ion-button>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- BOTÓN FLOTANTE DE WHATSAPP -->
  <!-- ========================================== -->
  <div class="whatsapp-container" [class.animate]="showWhatsappTooltip">
    <div class="tooltip" [class.in]="tooltipAnimateIn" [class.out]="tooltipAnimateOut">
      <div>
        <span *ngFor="let letter of tooltipLetters; let i = index"
              [style.--move]="letter.move"
              [style.--rotate]="letter.rotate"
              [style.--part]="letter.part"
              [innerHTML]="letter.char">
        </span>
      </div>
    </div>
    
    <a [href]="whatsappUrl" target="_blank" class="whatsapp-button"
       [class.in]="buttonAnimateIn" 
       [class.out]="buttonAnimateOut"
       (mouseenter)="onWhatsappHover(true)"
       (mouseleave)="onWhatsappHover(false)">
      <div class="whatsapp-icon">
        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 0C7.163 0 0 7.163 0 16c0 2.825.74 5.577 2.153 7.992L.051 31.847l8.111-2.064A15.927 15.927 0 0016 32c8.837 0 16-7.163 16-16S24.837 0 16 0zm0 29.333c-2.471 0-4.896-.688-6.989-2.001l-.502-.313-5.181 1.318 1.338-5.043-.342-.518A13.285 13.285 0 012.667 16c0-7.364 5.969-13.333 13.333-13.333S29.333 8.636 29.333 16 23.364 29.333 16 29.333zm7.299-9.941c-.401-.201-2.371-1.17-2.738-1.304-.369-.133-.637-.201-.906.201-.268.401-1.037 1.304-1.271 1.572-.234.268-.468.301-.869.1-.401-.2-1.692-.623-3.221-1.986-1.191-1.061-1.995-2.371-2.229-2.772-.234-.401-.025-.617.176-.817.181-.179.401-.468.602-.702.2-.234.268-.401.401-.669.134-.268.067-.502-.033-.702-.1-.201-.906-2.183-1.241-2.989-.326-.783-.659-.677-.906-.69-.234-.012-.502-.015-.77-.015s-.702.1-1.07.502c-.368.401-1.404 1.371-1.404 3.344s1.437 3.879 1.638 4.147c.201.268 2.826 4.315 6.849 6.052.957.413 1.704.66 2.286.845.961.305 1.836.262 2.527.159.771-.115 2.371-.969 2.705-1.904.334-.936.334-1.738.234-1.904-.1-.168-.368-.268-.769-.469z"/>
        </svg>
      </div>
      <div class="click-ring"></div>
    </a>
  </div>

</ion-header>