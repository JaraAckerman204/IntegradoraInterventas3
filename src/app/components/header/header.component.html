<ion-header>
  <ion-toolbar class="ultra-modern-toolbar">
    
    <!-- HEADER PRINCIPAL -->
    <div class="header-ultra-container">
      
      <!-- Logo con efecto especial -->
      <div class="logo-ultra-section">
        <div class="logo-ultra-wrapper" routerLink="/home">
          <div class="logo-shine"></div>
          <img class="logo-ultra-img" src="../../assets/img/logo.png" alt="Logo Interventas">
          <div class="logo-ring"></div>
        </div>
      </div>

      <!-- Navegación Desktop -->
      <nav class="ultra-nav-desktop">
        <div class="nav-ultra-items">
          
          <a class="nav-ultra-link" 
             routerLink="/home" 
             [class.active]="isHomeActive()">
            <div class="link-bg"></div>
            <ion-icon name="home-outline"></ion-icon>
            <span>Inicio</span>
          </a>

          <div class="nav-ultra-dropdown" #nosotrosDropdown>
            <button class="nav-ultra-link" 
                    (click)="toggleDropdown('nosotros', $event)"
                    [class.active]="isNosotrosActive()">
              <div class="link-bg"></div>
              <ion-icon name="people-outline"></ion-icon>
              <span>Nosotros</span>
              <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showNosotrosDropdown"></ion-icon>
            </button>
          </div>

          <div class="nav-ultra-dropdown" #productosDropdown>
            <button class="nav-ultra-link" 
                    (click)="toggleDropdown('productos', $event)"
                    [class.active]="isProductosActive()">
              <div class="link-bg"></div>
              <ion-icon name="cube-outline"></ion-icon>
              <span>Productos</span>
              <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showProductosDropdown"></ion-icon>
            </button>
          </div>

          <a class="nav-ultra-link" 
             routerLink="/sucursales"
             [class.active]="isSucursalesActive()">
            <div class="link-bg"></div>
            <ion-icon name="location-outline"></ion-icon>
            <span>Sucursales</span>
          </a>
          
        </div>
      </nav>

<!-- Sección de Acciones -->
<div class="ultra-actions">

  <!-- Carrito -->
  <button class="ultra-action-btn" routerLink="/carrito" [class.active]="isCartActive()">
    <div class="link-bg"></div>
    <ion-icon name="cart-outline"></ion-icon>
    <span class="action-text">Carrito</span>
    <span class="ultra-badge" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
  </button>

  <!-- Usuario Desktop -->
  <div class="ultra-user-desktop">
    
    <ng-container *ngIf="!user">
      <button class="ultra-login-btn" routerLink="/login">
        <div class="link-bg"></div>
        <ion-icon name="person-circle-outline"></ion-icon>
        <span>Entrar</span>
      </button>
    </ng-container>

<ng-container *ngIf="user">
  <button class="ultra-profile-btn active" 
          (click)="toggleProfileMenu()">
    <div class="link-bg"></div>
    <ion-icon name="person-circle-outline"></ion-icon>
    <span class="action-text">{{ getUserName() }}</span>
  </button>
</ng-container>
    
  </div>

  <!-- Botón Menú Mobile -->
  <button class="ultra-mobile-btn" (click)="toggleMenu()" [class.active]="showMobileMenu">
    <span></span>
    <span></span>
    <span></span>
  </button>

</div>

    </div>

    <!-- Línea decorativa animada -->
    <div class="ultra-divider">
      <div class="divider-flow"></div>
    </div>

  </ion-toolbar>

<!-- DROPDOWN NOSOTROS -->
<div class="ultra-dropdown" 
     *ngIf="showNosotrosDropdown" 
     [style.top]="dropdownPosition['top']"
     [style.left]="dropdownPosition['left']">
  
  <div class="dropdown-ultra-glass">
    
    <div class="dropdown-ultra-section">
      <a routerLink="/nosotros/contacto" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="mail-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Contacto</span>
          <span class="item-desc">Ponte en contacto con nosotros</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/nosotros/informacion" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="information-circle-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Información</span>
          <span class="item-desc">Conoce más sobre nuestra empresa</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
    </div>
  </div>
  
</div>

<!-- DROPDOWN PRODUCTOS -->
<div class="ultra-dropdown ultra-dropdown-wide" 
     *ngIf="showProductosDropdown" 
     [style.top]="dropdownPosition['top']"
     [style.left]="dropdownPosition['left']">
  
  <div class="dropdown-ultra-glass">
    
    <div class="dropdown-ultra-section">
      
      <a routerLink="/productos/todos" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="grid-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Todos</span>
          <span class="item-desc">Ver catálogo completo</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/desechables" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="cafe-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Desechables</span>
          <span class="item-desc">Vasos, platos y más</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/biodegradables" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="leaf-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Biodegradables</span>
          <span class="item-desc">Productos ecológicos</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/bolsas" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="bag-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Bolsas</span>
          <span class="item-desc">Todo tipo de bolsas</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/cocina-reposteria" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="restaurant-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Cocina</span>
          <span class="item-desc">Utensilios y más</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/alimentos" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="pizza-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Alimentos</span>
          <span class="item-desc">Productos alimenticios</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
      <a routerLink="/productos/higienicos-servilletas" 
         (click)="closeMenu()"
         class="dropdown-ultra-item-expanded">
        <ion-icon name="water-outline"></ion-icon>
        <div class="item-info">
          <span class="item-title">Higiénicos</span>
          <span class="item-desc">Papel y servilletas</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
      </a>
      
    </div>
  </div>
  
</div>

<!-- MENÚ PERFIL -->
<div class="ultra-profile-menu" *ngIf="showProfileMenu && user">
  <div class="profile-ultra-header">
    <ion-icon name="person-circle-outline"></ion-icon>
    <div>
      <span class="greeting">¡Hola!</span>
      <span class="name">{{ user.displayName || user.email }}</span>
    </div>
  </div>

  <!-- SECCIÓN PRINCIPAL -->
  <div class="profile-ultra-section">
    <a *ngIf="isAdmin" 
       routerLink="/admin"
       (click)="closeProfileMenu()"
       class="profile-ultra-item-expanded">
      <ion-icon name="shield-checkmark-outline"></ion-icon>
      <div class="item-info">
        <span class="item-title">Panel Admin</span>
        <span class="item-desc">Gestiona todo el sistema</span>
      </div>
      <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
    </a>

    <a routerLink="/perfil"
       (click)="closeProfileMenu()"
       class="profile-ultra-item-expanded">
      <ion-icon name="person-circle-outline"></ion-icon>
      <div class="item-info">
        <span class="item-title">Mi Perfil</span>
        <span class="item-desc">Edita tu información personal</span>
      </div>
      <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
    </a>
  </div>

  <!-- LÍNEA DIVISORIA -->
  <div class="profile-ultra-divider"></div>

  <!-- SECCIÓN SECUNDARIA (EN FILA) -->
  <div class="profile-ultra-footer-links">
    <a routerLink="/privacidad"
       (click)="closeProfileMenu()"
       class="footer-link">
      <ion-icon name="document-text-outline"></ion-icon>
      <span>Términos</span>
    </a>

    <div class="vertical-divider"></div>

    <a routerLink="/nosotros/contacto"
       (click)="closeProfileMenu()"
       class="footer-link">
      <ion-icon name="help-circle-outline"></ion-icon>
      <span>Ayuda</span>
    </a>
  </div>
  
  <button class="ultra-logout-btn" (click)="logout()">
    <ion-icon name="log-out-outline"></ion-icon>
    <span>Cerrar Sesión</span>
  </button>
</div>

<!-- SIDEBAR MOBILE -->
<div class="ultra-mobile-sidebar" [class.open]="showMobileMenu">
  <div class="sidebar-ultra-overlay" (click)="closeMenu()"></div>
  
  <div class="sidebar-ultra-panel">
    
    <!-- HEADER CON LOGO Y CLOSE -->
    <div class="sidebar-header-top">
      <img src="../../assets/img/logo.png" alt="Logo" class="logo-header">
      <button class="close-btn-x" (click)="closeMenu()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>

<!-- USUARIO CARD HORIZONTAL -->
<div class="user-horizontal-card" *ngIf="user">
  <div class="user-avatar-left">
    <div class="avatar-circle-dashed"></div>
    <div class="avatar-background">
      <ion-icon name="person-circle-outline"></ion-icon>
    </div>
  </div>
  <div class="user-info-right">
    <span class="user-greeting">¡BIENVENIDO!</span>
    <span class="user-name-main">{{ user.displayName || 'Usuario' }}</span>
    <span class="user-email-small">{{ user.email }}</span>
  </div>
</div>

    <!-- TABS -->
    <div class="nav-tabs-modern">
      <button class="tab-button" [class.active]="currentTab === 'menu'" (click)="currentTab = 'menu'">
        <ion-icon name="grid-outline"></ion-icon>
        <span>Menú</span>
      </button>
      <button class="tab-button" [class.active]="currentTab === 'account'" (click)="currentTab = 'account'" *ngIf="user">
        <ion-icon name="person-circle-outline"></ion-icon>
        <span>Cuenta</span>
      </button>
    </div>

    <!-- CONTENIDO -->
    <div class="sidebar-main-content">
      
      <!-- TAB: MENÚ CON DISEÑO DE LISTA -->
      <div class="content-panel" [class.active]="currentTab === 'menu'">
        
        <div class="menu-list">
          
          <a routerLink="/home" 
             [class.active]="isHomeActive()" 
             (click)="closeMenu()"
             class="menu-list-item">
            <div class="menu-icon-box">
              <ion-icon name="home-outline"></ion-icon>
            </div>
            <div class="menu-text">
              <span class="menu-title">Inicio</span>
              <span class="menu-subtitle">Página principal</span>
            </div>
            <ion-icon name="chevron-forward-outline" class="menu-chevron"></ion-icon>
          </a>

          <!-- NOSOTROS EXPANDIBLE -->
          <div class="menu-expandable-item" [class.expanded]="showNosotrosDropdown">
            <button (click)="toggleDropdown('nosotros', $event)" 
                    [class.active]="isNosotrosActive()"
                    class="menu-list-item">
              <div class="menu-icon-box">
                <ion-icon name="people-outline"></ion-icon>
              </div>
              <div class="menu-text">
                <span class="menu-title">Nosotros</span>
                <span class="menu-subtitle">Conoce más</span>
              </div>
              <ion-icon name="chevron-down-outline" class="expand-arrow" [class.rotate]="showNosotrosDropdown"></ion-icon>
            </button>
            
            <div class="submenu-list" [class.show]="showNosotrosDropdown">
              <a routerLink="/nosotros/contacto" (click)="closeMenu()" class="submenu-item">
                <ion-icon name="mail-outline"></ion-icon>
                <div class="submenu-text">
                  <span class="submenu-title">Contacto</span>
                  <span class="submenu-desc">Escríbenos</span>
                </div>
              </a>
              <a routerLink="/nosotros/informacion" (click)="closeMenu()" class="submenu-item">
                <ion-icon name="information-circle-outline"></ion-icon>
                <div class="submenu-text">
                  <span class="submenu-title">Información</span>
                  <span class="submenu-desc">Sobre nosotros</span>
                </div>
              </a>
            </div>
          </div>

          <!-- PRODUCTOS EXPANDIBLE -->
          <div class="menu-expandable-item" [class.expanded]="showProductosDropdown">
            <button (click)="toggleDropdown('productos', $event)" 
                    [class.active]="isProductosActive()"
                    class="menu-list-item">
              <div class="menu-icon-box">
                <ion-icon name="cube-outline"></ion-icon>
              </div>
              <div class="menu-text">
                <span class="menu-title">Productos</span>
                <span class="menu-subtitle">Nuestro catálogo</span>
              </div>
              <ion-icon name="chevron-down-outline" class="expand-arrow" [class.rotate]="showProductosDropdown"></ion-icon>
            </button>
            
            <div class="submenu-list" [class.show]="showProductosDropdown">
              <a routerLink="/productos/todos" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="grid-outline"></ion-icon>
                <span>Todos los productos</span>
              </a>
              <a routerLink="/productos/desechables" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="cafe-outline"></ion-icon>
                <span>Desechables</span>
              </a>
              <a routerLink="/productos/biodegradables" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="leaf-outline"></ion-icon>
                <span>Biodegradables</span>
              </a>
              <a routerLink="/productos/bolsas" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="bag-outline"></ion-icon>
                <span>Bolsas</span>
              </a>
              <a routerLink="/productos/cocina-reposteria" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="restaurant-outline"></ion-icon>
                <span>Cocina y repostería</span>
              </a>
              <a routerLink="/productos/alimentos" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="pizza-outline"></ion-icon>
                <span>Alimentos</span>
              </a>
              <a routerLink="/productos/higienicos-servilletas" (click)="closeMenu()" class="submenu-item simple">
                <ion-icon name="water-outline"></ion-icon>
                <span>Higiénicos</span>
              </a>
            </div>
          </div>

          <a routerLink="/sucursales" 
             [class.active]="isSucursalesActive()" 
             (click)="closeMenu()"
             class="menu-list-item">
            <div class="menu-icon-box">
              <ion-icon name="location-outline"></ion-icon>
            </div>
            <div class="menu-text">
              <span class="menu-title">Sucursales</span>
              <span class="menu-subtitle">Nuestras ubicaciones</span>
            </div>
            <ion-icon name="chevron-forward-outline" class="menu-chevron"></ion-icon>
          </a>

        </div>

      </div>

      <!-- TAB: CUENTA -->
      <div class="content-panel" [class.active]="currentTab === 'account'" *ngIf="user">
        
        <div class="account-cards">
          
          <a *ngIf="isAdmin" 
             routerLink="/admin" 
             [class.active]="isAdminActive()" 
             (click)="closeMenu()"
             class="account-card">
            <div class="account-icon-box">
              <ion-icon name="shield-checkmark-outline"></ion-icon>
            </div>
            <div class="account-text">
              <span class="account-title">Panel Admin</span>
              <span class="account-subtitle">Administración completa</span>
            </div>
            <ion-icon name="chevron-forward-outline" class="account-chevron"></ion-icon>
          </a>

          <a routerLink="/perfil" 
             [class.active]="isPerfilActive()" 
             (click)="closeMenu()"
             class="account-card">
            <div class="account-icon-box">
              <ion-icon name="person-circle-outline"></ion-icon>
            </div>
            <div class="account-text">
              <span class="account-title">Mi Perfil</span>
              <span class="account-subtitle">Información personal</span>
            </div>
            <ion-icon name="chevron-forward-outline" class="account-chevron"></ion-icon>
          </a>

          <div class="separator"></div>

          <a routerLink="/privacidad" 
             (click)="closeMenu()"
             class="account-card compact">
            <ion-icon name="document-text-outline"></ion-icon>
            <span>Términos y privacidad</span>
          </a>

          <a routerLink="/nosotros/contacto" 
             (click)="closeMenu()"
             class="account-card compact">
            <ion-icon name="help-circle-outline"></ion-icon>
            <span>Centro de ayuda</span>
          </a>

        </div>

      </div>

    </div>

    <!-- FOOTER -->
    <div class="sidebar-footer-action">
      <ng-container *ngIf="!user">
        <button class="action-btn login-btn" routerLink="/login" (click)="closeMenu()">
          <ion-icon name="log-in-outline"></ion-icon>
          <span>Iniciar Sesión</span>
        </button>
      </ng-container>

      <ng-container *ngIf="user">
        <button class="action-btn logout-btn" (click)="logout()">
          <ion-icon name="log-out-outline"></ion-icon>
          <span>Cerrar Sesión</span>
        </button>
      </ng-container>
    </div>

  </div>
</div>

  <!-- BOTÓN WHATSAPP (mantener el original) -->
  <div class="whatsapp-container" [class.animate]="showWhatsappTooltip">
    <div class="tooltip" [class.in]="tooltipAnimateIn" [class.out]="tooltipAnimateOut">
      <div>
        <span *ngFor="let letter of tooltipLetters; let i = index"
              [style.--move]="letter.move"
              [style.--rotate]="letter.rotate"
              [style.--part]="letter.part"
              [innerHTML]="letter.char">
        </span>
      </div>
    </div>
    
    <a [href]="whatsappUrl" target="_blank" class="whatsapp-button"
       [class.in]="buttonAnimateIn" 
       [class.out]="buttonAnimateOut"
       (mouseenter)="onWhatsappHover(true)"
       (mouseleave)="onWhatsappHover(false)">
      <div class="whatsapp-icon">
        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 0C7.163 0 0 7.163 0 16c0 2.825.74 5.577 2.153 7.992L.051 31.847l8.111-2.064A15.927 15.927 0 0016 32c8.837 0 16-7.163 16-16S24.837 0 16 0zm0 29.333c-2.471 0-4.896-.688-6.989-2.001l-.502-.313-5.181 1.318 1.338-5.043-.342-.518A13.285 13.285 0 012.667 16c0-7.364 5.969-13.333 13.333-13.333S29.333 8.636 29.333 16 23.364 29.333 16 29.333zm7.299-9.941c-.401-.201-2.371-1.17-2.738-1.304-.369-.133-.637-.201-.906.201-.268.401-1.037 1.304-1.271 1.572-.234.268-.468.301-.869.1-.401-.2-1.692-.623-3.221-1.986-1.191-1.061-1.995-2.371-2.229-2.772-.234-.401-.025-.617.176-.817.181-.179.401-.468.602-.702.2-.234.268-.401.401-.669.134-.268.067-.502-.033-.702-.1-.201-.906-2.183-1.241-2.989-.326-.783-.659-.677-.906-.69-.234-.012-.502-.015-.77-.015s-.702.1-1.07.502c-.368.401-1.404 1.371-1.404 3.344s1.437 3.879 1.638 4.147c.201.268 2.826 4.315 6.849 6.052.957.413 1.704.66 2.286.845.961.305 1.836.262 2.527.159.771-.115 2.371-.969 2.705-1.904.334-.936.334-1.738.234-1.904-.1-.168-.368-.268-.769-.469z"/>
        </svg>
      </div>
      <div class="click-ring"></div>
    </a>
  </div>

</ion-header>