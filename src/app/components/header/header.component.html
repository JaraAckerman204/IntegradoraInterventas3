<ion-header>
  <ion-toolbar class="modern-toolbar">
    
    <!-- Contenedor Principal con Flex Mejorado -->
    <div class="header-container">
      
      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-wrapper" routerLink="/home">
          <ion-img class="logo-img" src="../../assets/img/logo.png" alt="Logo Interventas"></ion-img>
          <div class="logo-glow"></div>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <ion-button 
          fill="clear" 
          class="nav-link" 
          routerLink="/home" 
          [class.active]="isHomeActive()">
          <span class="link-text">Inicio</span>
          <div class="link-underline"></div>
        </ion-button>

        <div class="nav-dropdown">
          <ion-button 
            fill="clear" 
            class="nav-link" 
            (click)="toggleDropdown('nosotros', $event)"
            [class.active]="isNosotrosActive()">
            <span class="link-text">Nosotros</span>
            <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
            <div class="link-underline"></div>
          </ion-button>
        </div>

        <div class="nav-dropdown">
          <ion-button 
            fill="clear" 
            class="nav-link" 
            (click)="toggleDropdown('productos', $event)"
            [class.active]="isProductosActive()">
            <span class="link-text">Productos</span>
            <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
            <div class="link-underline"></div>
          </ion-button>
        </div>

        <ion-button 
          fill="clear" 
          class="nav-link" 
          routerLink="/sucursales"
          [class.active]="isSucursalesActive()">
          <span class="link-text">Sucursales</span>
          <div class="link-underline"></div>
        </ion-button>
      </nav>

      <!-- Actions Section -->
      <div class="actions-section">

        <!-- Cart Button -->
        <ion-button fill="clear" class="action-btn cart-btn" routerLink="/carrito">
          <ion-icon [icon]="cartOutline" class="action-icon"></ion-icon>
          <span class="cart-count" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
        </ion-button>

        <!-- User Section -->
        <div class="user-section">
          <!-- Not Logged In -->
          <ng-container *ngIf="!user">
            <ion-button class="login-btn" routerLink="/login">
              <ion-icon [icon]="logInOutline" slot="start"></ion-icon>
              <span>Iniciar Sesión</span>
            </ion-button>
          </ng-container>

          <!-- Logged In -->
          <ng-container *ngIf="user">
            <ion-button fill="clear" class="profile-btn" (click)="toggleProfileMenu()">
              <ion-icon [icon]="personCircleOutline" class="profile-icon"></ion-icon>
            </ion-button>
          </ng-container>
        </div>

        <!-- Mobile Menu Button -->
        <ion-button fill="clear" class="mobile-menu-btn" (click)="toggleMenu()">
          <ion-icon [icon]="menuOutline" class="mobile-icon"></ion-icon>
        </ion-button>
      </div>

    </div>

    <!-- Gradient Border Bottom -->
    <div class="gradient-border"></div>

  </ion-toolbar>

  <!-- ========================================== -->
  <!-- DROPDOWN NOSOTROS -->
  <!-- ========================================== -->
  <div class="modern-dropdown" 
       *ngIf="showNosotrosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    <div class="dropdown-header">
      <h3>Nosotros</h3>
    </div>
    <div class="dropdown-content">
      <a class="dropdown-link" routerLink="/nosotros/contacto" (click)="closeMenu()">
        <ion-icon name="mail-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Contacto</span>
          <span class="link-desc">Ponte en contacto con nosotros</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/nosotros/informacion" (click)="closeMenu()">
        <ion-icon name="information-circle-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Información</span>
          <span class="link-desc">Conoce más sobre nosotros</span>
        </div>
      </a>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- DROPDOWN PRODUCTOS -->
  <!-- ========================================== -->
  <div class="modern-dropdown" 
       *ngIf="showProductosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    <div class="dropdown-header">
      <h3>Nuestros Productos</h3>
    </div>
    <div class="dropdown-content">
      <a class="dropdown-link" routerLink="/productos/todos" (click)="closeMenu()">
        <ion-icon name="grid-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Todos los Productos</span>
          <span class="link-desc">Explora nuestro catálogo completo</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/desechables" (click)="closeMenu()">
        <ion-icon name="cafe-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Desechables</span>
          <span class="link-desc">Vasos, platos y cubiertos</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/biodegradables" (click)="closeMenu()">
        <ion-icon name="leaf-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Biodegradables</span>
          <span class="link-desc">Productos eco-friendly</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/bolsas" (click)="closeMenu()">
        <ion-icon name="bag-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Bolsas</span>
          <span class="link-desc">Para todo tipo de uso</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/cocina-reposteria" (click)="closeMenu()">
        <ion-icon name="restaurant-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Cocina y Repostería</span>
          <span class="link-desc">Utensilios y accesorios</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/alimentos" (click)="closeMenu()">
        <ion-icon name="pizza-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Alimentos</span>
          <span class="link-desc">Productos alimenticios</span>
        </div>
      </a>
      <a class="dropdown-link" routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">
        <ion-icon name="water-outline" class="link-icon"></ion-icon>
        <div class="link-info">
          <span class="link-title">Higiénicos y Servilletas</span>
          <span class="link-desc">Papel y productos de limpieza</span>
        </div>
      </a>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- PROFILE MENU -->
  <!-- ========================================== -->
  <div class="profile-dropdown" *ngIf="showProfileMenu && user">
    <div class="profile-header">
      <ion-icon [icon]="personCircleOutline" class="profile-avatar"></ion-icon>
      <div class="profile-info">
        <span class="profile-greeting">¡Hola!</span>
        <span class="profile-name">{{ user.displayName || user.email }}</span>
      </div>
    </div>
    <div class="profile-divider"></div>
    <ion-button expand="block" class="logout-button" (click)="logout()">
      <ion-icon [icon]="logOutOutline" slot="start"></ion-icon>
      <span>Cerrar Sesión</span>
    </ion-button>
  </div>

  <!-- ========================================== -->
  <!-- MOBILE SIDEBAR MENU -->
  <!-- ========================================== -->
  <div class="mobile-sidebar" [class.open]="showMobileMenu">
    <div class="sidebar-overlay" (click)="closeMenu()"></div>
    
    <div class="sidebar-content">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <ion-img class="sidebar-logo" src="../../assets/img/logo.png" alt="Logo"></ion-img>
        <ion-button fill="clear" class="close-btn" (click)="closeMenu()">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- User Info Mobile -->
      <div class="sidebar-user" *ngIf="user">
        <ion-icon [icon]="personCircleOutline" class="sidebar-avatar"></ion-icon>
        <div class="sidebar-user-info">
          <span class="sidebar-greeting">Bienvenido</span>
          <span class="sidebar-name">{{ user.displayName || user.email }}</span>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <nav class="sidebar-nav">
        <a class="sidebar-link" routerLink="/home" [class.active]="isHomeActive()" (click)="closeMenu()">
          <ion-icon name="home-outline" class="sidebar-icon"></ion-icon>
          <span>Inicio</span>
        </a>

        <div class="sidebar-dropdown">
          <button class="sidebar-link dropdown-trigger" (click)="toggleDropdown('nosotros', $event)" [class.active]="isNosotrosActive()">
            <ion-icon name="people-outline" class="sidebar-icon"></ion-icon>
            <span>Nosotros</span>
            <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showNosotrosDropdown"></ion-icon>
          </button>
          <div class="sidebar-submenu" *ngIf="showNosotrosDropdown">
            <a routerLink="/nosotros/contacto" (click)="closeMenu()">Contacto</a>
            <a routerLink="/nosotros/informacion" (click)="closeMenu()">Información</a>
          </div>
        </div>

        <div class="sidebar-dropdown">
          <button class="sidebar-link dropdown-trigger" (click)="toggleDropdown('productos', $event)" [class.active]="isProductosActive()">
            <ion-icon name="cube-outline" class="sidebar-icon"></ion-icon>
            <span>Productos</span>
            <ion-icon name="chevron-down-outline" class="chevron" [class.rotate]="showProductosDropdown"></ion-icon>
          </button>
          <div class="sidebar-submenu" *ngIf="showProductosDropdown">
            <a routerLink="/productos/todos" (click)="closeMenu()">Todos</a>
            <a routerLink="/productos/desechables" (click)="closeMenu()">Desechables</a>
            <a routerLink="/productos/biodegradables" (click)="closeMenu()">Biodegradables</a>
            <a routerLink="/productos/bolsas" (click)="closeMenu()">Bolsas</a>
            <a routerLink="/productos/cocina-reposteria" (click)="closeMenu()">Cocina y Repostería</a>
            <a routerLink="/productos/alimentos" (click)="closeMenu()">Alimentos</a>
            <a routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">Higiénicos y Servilletas</a>
          </div>
        </div>

        <a class="sidebar-link" routerLink="/sucursales" [class.active]="isSucursalesActive()" (click)="closeMenu()">
          <ion-icon name="location-outline" class="sidebar-icon"></ion-icon>
          <span>Sucursales</span>
        </a>
      </nav>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer">
        <ng-container *ngIf="!user">
          <ion-button expand="block" class="sidebar-login-btn" routerLink="/login" (click)="closeMenu()">
            <ion-icon [icon]="logInOutline" slot="start"></ion-icon>
            <span>Iniciar Sesión</span>
          </ion-button>
        </ng-container>

        <ng-container *ngIf="user">
          <ion-button expand="block" color="danger" class="sidebar-logout-btn" (click)="logout()">
            <ion-icon [icon]="logOutOutline" slot="start"></ion-icon>
            <span>Cerrar Sesión</span>
          </ion-button>
        </ng-container>
      </div>
    </div>
  </div>

</ion-header>