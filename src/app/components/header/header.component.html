<ion-header>
  <ion-toolbar class="modern-toolbar">
    
    <!-- ========================================== -->
    <!-- HEADER CONTAINER PRINCIPAL -->
    <!-- ========================================== -->
    <div class="header-container">
      
      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-wrapper" routerLink="/home">
          <div class="logo-glow"></div>
          <img class="logo-img" src="../../assets/img/logo.png" alt="Logo Interventas">
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <div class="nav-pills">
          
          <a class="nav-pill" 
             routerLink="/home" 
             [class.active]="isHomeActive()">
            <ion-icon name="home-outline" class="pill-icon"></ion-icon>
            <span>Inicio</span>
            <div class="pill-glow"></div>
          </a>

          <div class="nav-pill-dropdown">
            <button class="nav-pill" 
                    (click)="toggleDropdown('nosotros', $event)"
                    [class.active]="isNosotrosActive()">
              <ion-icon name="people-outline" class="pill-icon"></ion-icon>
              <span>Nosotros</span>
              <ion-icon name="chevron-down-outline" class="chevron-icon" [class.rotate]="showNosotrosDropdown"></ion-icon>
              <div class="pill-glow"></div>
            </button>
          </div>

          <div class="nav-pill-dropdown">
            <button class="nav-pill" 
                    (click)="toggleDropdown('productos', $event)"
                    [class.active]="isProductosActive()">
              <ion-icon name="cube-outline" class="pill-icon"></ion-icon>
              <span>Productos</span>
              <ion-icon name="chevron-down-outline" class="chevron-icon" [class.rotate]="showProductosDropdown"></ion-icon>
              <div class="pill-glow"></div>
            </button>
          </div>

          <a class="nav-pill" 
             routerLink="/sucursales"
             [class.active]="isSucursalesActive()">
            <ion-icon name="location-outline" class="pill-icon"></ion-icon>
            <span>Sucursales</span>
            <div class="pill-glow"></div>
          </a>
          
        </div>
      </nav>

      <!-- Actions Section -->
      <div class="actions-section">

        <!-- Cart Button -->
        <button class="action-btn cart-action" routerLink="/carrito" [class.active]="isCartActive()">
          <div class="action-icon-wrapper">
            <ion-icon name="cart-outline"></ion-icon>
            <span class="cart-badge" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
          </div>
          <div class="action-tooltip">Carrito</div>
        </button>

        <!-- User Section Desktop -->
        <div class="user-section-desktop">
          
          <!-- Not Logged In -->
          <ng-container *ngIf="!user">
            <button class="login-btn-modern" routerLink="/login">
              <div class="btn-bg"></div>
              <ion-icon name="log-in-outline"></ion-icon>
              <span>Iniciar Sesión</span>
            </button>
          </ng-container>

          <!-- Logged In -->
          <ng-container *ngIf="user">
            <button class="profile-action" (click)="toggleProfileMenu()" [class.active]="showProfileMenu">
              <div class="profile-avatar-mini">
                <ion-icon name="person-outline"></ion-icon>
              </div>
              <div class="profile-indicator"></div>
            </button>
          </ng-container>
          
        </div>

        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" (click)="toggleMenu()" [class.active]="showMobileMenu">
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>

      </div>

    </div>

    <!-- Gradient Border Animated -->
    <div class="gradient-border-animated">
      <div class="gradient-flow"></div>
    </div>

  </ion-toolbar>

  <!-- ========================================== -->
  <!-- DROPDOWN NOSOTROS - REDISEÑADO -->
  <!-- ========================================== -->
  <div class="dropdown-modern" 
       *ngIf="showNosotrosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    
    <div class="dropdown-glass">
      <div class="dropdown-header-modern">
        <div class="header-icon-wrapper">
          <ion-icon name="people-outline"></ion-icon>
        </div>
        <div class="header-text">
          <h3>Nosotros</h3>
          <p>Conoce nuestra empresa</p>
        </div>
      </div>
      
      <div class="dropdown-items">
        <a class="dropdown-item-modern" routerLink="/nosotros/contacto" (click)="closeMenu()">
          <div class="item-icon contact">
            <ion-icon name="mail-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Contacto</span>
            <span class="item-desc">Ponte en contacto con nosotros</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/nosotros/informacion" (click)="closeMenu()">
          <div class="item-icon info">
            <ion-icon name="information-circle-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Información</span>
            <span class="item-desc">Conoce más sobre nosotros</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
      </div>
    </div>
    
  </div>

  <!-- ========================================== -->
  <!-- DROPDOWN PRODUCTOS - REDISEÑADO -->
  <!-- ========================================== -->
  <div class="dropdown-modern dropdown-productos" 
       *ngIf="showProductosDropdown" 
       [style.top]="dropdownPosition['top']"
       [style.left]="dropdownPosition['left']">
    
    <div class="dropdown-glass">
      <div class="dropdown-header-modern">
        <div class="header-icon-wrapper productos">
          <ion-icon name="cube-outline"></ion-icon>
        </div>
        <div class="header-text">
          <h3>Nuestros Productos</h3>
          <p>Explora nuestro catálogo completo</p>
        </div>
      </div>
      
      <div class="dropdown-items productos-grid">
        
        <a class="dropdown-item-modern" routerLink="/productos/todos" (click)="closeMenu()">
          <div class="item-icon todos">
            <ion-icon name="grid-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Todos</span>
            <span class="item-desc">Ver catálogo completo</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/desechables" (click)="closeMenu()">
          <div class="item-icon desechables">
            <ion-icon name="cafe-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Desechables</span>
            <span class="item-desc">Vasos, platos y cubiertos</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/biodegradables" (click)="closeMenu()">
          <div class="item-icon biodegradables">
            <ion-icon name="leaf-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Biodegradables</span>
            <span class="item-desc">Productos eco-friendly</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/bolsas" (click)="closeMenu()">
          <div class="item-icon bolsas">
            <ion-icon name="bag-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Bolsas</span>
            <span class="item-desc">Para todo tipo de uso</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/cocina-reposteria" (click)="closeMenu()">
          <div class="item-icon cocina">
            <ion-icon name="restaurant-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Cocina y Repostería</span>
            <span class="item-desc">Utensilios y accesorios</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/alimentos" (click)="closeMenu()">
          <div class="item-icon alimentos">
            <ion-icon name="pizza-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Alimentos</span>
            <span class="item-desc">Productos alimenticios</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
        <a class="dropdown-item-modern" routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">
          <div class="item-icon higienicos">
            <ion-icon name="water-outline"></ion-icon>
          </div>
          <div class="item-info">
            <span class="item-title">Higiénicos</span>
            <span class="item-desc">Papel y limpieza</span>
          </div>
          <ion-icon name="arrow-forward-outline" class="item-arrow"></ion-icon>
        </a>
        
      </div>
    </div>
    
  </div>

  <!-- ========================================== -->
  <!-- PROFILE MENU (MANTENER EL QUE YA TIENES) -->
  <!-- ========================================== -->
  <div class="profile-dropdown" *ngIf="showProfileMenu && user">
    <div class="profile-header">
      <ion-icon [icon]="personCircleOutline" class="profile-avatar"></ion-icon>
      <div class="profile-info">
        <span class="profile-greeting">¡Hola!</span>
        <span class="profile-name">{{ user.displayName || user.email }}</span>
      </div>
    </div>

    <div class="profile-menu-content">
      <a class="profile-menu-item" 
         *ngIf="isAdmin" 
         routerLink="/admin"
         (click)="closeProfileMenu()">
        <div class="menu-item-icon admin-icon">
          <ion-icon [icon]="shieldCheckmarkOutline"></ion-icon>
        </div>
        <div class="menu-item-text">
          <span class="menu-item-title">Panel Admin</span>
          <span class="menu-item-desc">Gestionar sistema</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="menu-item-arrow"></ion-icon>
      </a>

      <a class="profile-menu-item" 
         routerLink="/perfil"
         (click)="closeProfileMenu()">
        <div class="menu-item-icon profile-icon-menu">
          <ion-icon [icon]="personCircleOutline"></ion-icon>
        </div>
        <div class="menu-item-text">
          <span class="menu-item-title">Mi Perfil</span>
          <span class="menu-item-desc">Ver y editar información</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="menu-item-arrow"></ion-icon>
      </a>
    </div>
    
    <div class="profile-divider"></div>
    
    <ion-button expand="block" class="logout-button" (click)="logout()">
      <ion-icon [icon]="logOutOutline" slot="start"></ion-icon>
      <span>Cerrar Sesión</span>
    </ion-button>
  </div>

  <!-- ========================================== -->
  <!-- MOBILE SIDEBAR - REDISEÑADO -->
  <!-- ========================================== -->
  <div class="mobile-sidebar-modern" [class.open]="showMobileMenu">
    <div class="sidebar-overlay" (click)="closeMenu()"></div>
    
    <div class="sidebar-panel">
      
      <!-- Sidebar Header -->
      <div class="sidebar-header-modern">
        <div class="header-brand">
          <img src="../../assets/img/logo.png" alt="Logo" class="sidebar-logo">
        </div>
        <button class="close-sidebar-btn" (click)="closeMenu()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- User Card Mobile -->
      <div class="user-card-mobile" *ngIf="user">
        <div class="user-card-bg"></div>
        <div class="user-avatar-mobile">
          <ion-icon name="person-outline"></ion-icon>
          <div class="avatar-ring-mobile"></div>
        </div>
        <div class="user-info-mobile">
          <span class="user-greeting-mobile">¡Bienvenido!</span>
          <span class="user-name-mobile">{{ user.displayName || 'Usuario' }}</span>
          <span class="user-email-mobile">{{ user.email }}</span>
        </div>
      </div>

      <!-- Navigation Links -->
      <nav class="sidebar-nav-modern">
        
        <!-- Admin Link -->
        <a *ngIf="isAdmin" 
           class="nav-item-mobile admin-nav" 
           routerLink="/admin" 
           [class.active]="isAdminActive()" 
           (click)="closeMenu()">
          <div class="nav-icon-mobile">
            <ion-icon name="shield-checkmark-outline"></ion-icon>
          </div>
          <span>Panel Admin</span>
          <ion-icon name="chevron-forward-outline" class="nav-arrow"></ion-icon>
        </a>

        <!-- Perfil Link -->
        <a *ngIf="user" 
           class="nav-item-mobile" 
           routerLink="/perfil" 
           [class.active]="isPerfilActive()" 
           (click)="closeMenu()">
          <div class="nav-icon-mobile">
            <ion-icon name="person-outline"></ion-icon>
          </div>
          <span>Mi Perfil</span>
          <ion-icon name="chevron-forward-outline" class="nav-arrow"></ion-icon>
        </a>

        <div class="nav-divider"></div>

        <!-- Inicio -->
        <a class="nav-item-mobile" 
           routerLink="/home" 
           [class.active]="isHomeActive()" 
           (click)="closeMenu()">
          <div class="nav-icon-mobile">
            <ion-icon name="home-outline"></ion-icon>
          </div>
          <span>Inicio</span>
          <ion-icon name="chevron-forward-outline" class="nav-arrow"></ion-icon>
        </a>

        <!-- Nosotros Dropdown -->
        <div class="nav-group-mobile">
          <button class="nav-item-mobile" 
                  (click)="toggleDropdown('nosotros', $event)" 
                  [class.active]="isNosotrosActive()">
            <div class="nav-icon-mobile">
              <ion-icon name="people-outline"></ion-icon>
            </div>
            <span>Nosotros</span>
            <ion-icon name="chevron-down-outline" class="nav-chevron" [class.rotate]="showNosotrosDropdown"></ion-icon>
          </button>
          <div class="nav-submenu-mobile" [class.open]="showNosotrosDropdown">
            <a routerLink="/nosotros/contacto" (click)="closeMenu()">
              <ion-icon name="mail-outline"></ion-icon>
              Contacto
            </a>
            <a routerLink="/nosotros/informacion" (click)="closeMenu()">
              <ion-icon name="information-circle-outline"></ion-icon>
              Información
            </a>
          </div>
        </div>

        <!-- Productos Dropdown -->
        <div class="nav-group-mobile">
          <button class="nav-item-mobile" 
                  (click)="toggleDropdown('productos', $event)" 
                  [class.active]="isProductosActive()">
            <div class="nav-icon-mobile">
              <ion-icon name="cube-outline"></ion-icon>
            </div>
            <span>Productos</span>
            <ion-icon name="chevron-down-outline" class="nav-chevron" [class.rotate]="showProductosDropdown"></ion-icon>
          </button>
          <div class="nav-submenu-mobile" [class.open]="showProductosDropdown">
            <a routerLink="/productos/todos" (click)="closeMenu()">
              <ion-icon name="grid-outline"></ion-icon>
              Todos los productos
            </a>
            <a routerLink="/productos/desechables" (click)="closeMenu()">
              <ion-icon name="cafe-outline"></ion-icon>
              Desechables
            </a>
            <a routerLink="/productos/biodegradables" (click)="closeMenu()">
              <ion-icon name="leaf-outline"></ion-icon>
              Biodegradables
            </a>
            <a routerLink="/productos/bolsas" (click)="closeMenu()">
              <ion-icon name="bag-outline"></ion-icon>
              Bolsas
            </a>
            <a routerLink="/productos/cocina-reposteria" (click)="closeMenu()">
              <ion-icon name="restaurant-outline"></ion-icon>
              Cocina y Repostería
            </a>
            <a routerLink="/productos/alimentos" (click)="closeMenu()">
              <ion-icon name="pizza-outline"></ion-icon>
              Alimentos
            </a>
            <a routerLink="/productos/higienicos-servilletas" (click)="closeMenu()">
              <ion-icon name="water-outline"></ion-icon>
              Higiénicos y Servilletas
            </a>
          </div>
        </div>

        <!-- Sucursales -->
        <a class="nav-item-mobile" 
           routerLink="/sucursales" 
           [class.active]="isSucursalesActive()" 
           (click)="closeMenu()">
          <div class="nav-icon-mobile">
            <ion-icon name="location-outline"></ion-icon>
          </div>
          <span>Sucursales</span>
          <ion-icon name="chevron-forward-outline" class="nav-arrow"></ion-icon>
        </a>

        <!-- Carrito -->
        <a class="nav-item-mobile cart-nav" 
           routerLink="/carrito" 
           [class.active]="isCartActive()" 
           (click)="closeMenu()">
          <div class="nav-icon-mobile">
            <ion-icon name="cart-outline"></ion-icon>
          </div>
          <span>Mi Carrito</span>
          <span class="cart-badge-mobile" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
          <ion-icon name="chevron-forward-outline" class="nav-arrow"></ion-icon>
        </a>

      </nav>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer-modern">
        <ng-container *ngIf="!user">
          <button class="login-btn-mobile" routerLink="/login" (click)="closeMenu()">
            <ion-icon name="log-in-outline"></ion-icon>
            <span>Iniciar Sesión</span>
          </button>
          <button class="register-btn-mobile" routerLink="/register" (click)="closeMenu()">
            <ion-icon name="person-add-outline"></ion-icon>
            <span>Registrarse</span>
          </button>
        </ng-container>

        <ng-container *ngIf="user">
          <button class="logout-btn-mobile" (click)="logout()">
            <ion-icon name="log-out-outline"></ion-icon>
            <span>Cerrar Sesión</span>
          </button>
        </ng-container>
      </div>

    </div>
  </div>

  <!-- ========================================== -->
  <!-- BOTÓN FLOTANTE DE WHATSAPP -->
  <!-- ========================================== -->
  <div class="whatsapp-container" [class.animate]="showWhatsappTooltip">
    <div class="tooltip" [class.in]="tooltipAnimateIn" [class.out]="tooltipAnimateOut">
      <div>
        <span *ngFor="let letter of tooltipLetters; let i = index"
              [style.--move]="letter.move"
              [style.--rotate]="letter.rotate"
              [style.--part]="letter.part"
              [innerHTML]="letter.char">
        </span>
      </div>
    </div>
    
    <a [href]="whatsappUrl" target="_blank" class="whatsapp-button"
       [class.in]="buttonAnimateIn" 
       [class.out]="buttonAnimateOut"
       (mouseenter)="onWhatsappHover(true)"
       (mouseleave)="onWhatsappHover(false)">
      <div class="whatsapp-icon">
        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 0C7.163 0 0 7.163 0 16c0 2.825.74 5.577 2.153 7.992L.051 31.847l8.111-2.064A15.927 15.927 0 0016 32c8.837 0 16-7.163 16-16S24.837 0 16 0zm0 29.333c-2.471 0-4.896-.688-6.989-2.001l-.502-.313-5.181 1.318 1.338-5.043-.342-.518A13.285 13.285 0 012.667 16c0-7.364 5.969-13.333 13.333-13.333S29.333 8.636 29.333 16 23.364 29.333 16 29.333zm7.299-9.941c-.401-.201-2.371-1.17-2.738-1.304-.369-.133-.637-.201-.906.201-.268.401-1.037 1.304-1.271 1.572-.234.268-.468.301-.869.1-.401-.2-1.692-.623-3.221-1.986-1.191-1.061-1.995-2.371-2.229-2.772-.234-.401-.025-.617.176-.817.181-.179.401-.468.602-.702.2-.234.268-.401.401-.669.134-.268.067-.502-.033-.702-.1-.201-.906-2.183-1.241-2.989-.326-.783-.659-.677-.906-.69-.234-.012-.502-.015-.77-.015s-.702.1-1.07.502c-.368.401-1.404 1.371-1.404 3.344s1.437 3.879 1.638 4.147c.201.268 2.826 4.315 6.849 6.052.957.413 1.704.66 2.286.845.961.305 1.836.262 2.527.159.771-.115 2.371-.969 2.705-1.904.334-.936.334-1.738.234-1.904-.1-.168-.368-.268-.769-.469z"/>
        </svg>
      </div>
      <div class="click-ring"></div>
    </a>
  </div>

</ion-header>