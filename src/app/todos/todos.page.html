<app-header></app-header>

<ion-content [fullscreen]="true">

  <!-- SECCIÓN HERO -->
  <section class="products-hero">
    <div class="hero-content">
      <div class="hero-icon">
        <ion-icon name="cart-outline"></ion-icon>
      </div>
      <h1>Productos Destacados</h1>
      <p>Descubre nuestra selección exclusiva de productos de la más alta calidad</p>
    </div>
  </section>

  <!-- SECCIÓN PRINCIPAL DE PRODUCTOS -->
  <section class="products-section ion-padding">
    
    <!-- Indicador de carga -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-wrapper">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando productos...</p>
      </div>
    </div>

    <!-- Mensaje si no hay productos -->
    <div *ngIf="!loading && products.length === 0" class="no-products">
      <div class="empty-state">
        <ion-icon name="cube-outline"></ion-icon>
        <h3>No hay productos disponibles</h3>
        <p>Pronto tendremos nuevos productos para ti</p>
      </div>
    </div>

    <!-- Grid de productos -->
    <div *ngIf="!loading && products.length > 0" class="products-container">
      <div class="products-grid">
        
        <div class="product-card reveal" *ngFor="let product of products">
          <div class="card-inner">
            
            <!-- Imagen del producto -->
            <div class="product-image">
              <img 
                [src]="product.imagen || 'assets/img/placeholder.png'" 
                [alt]="product.nombre"
                (error)="$event.target.src='assets/img/placeholder.png'"
              >
              <div class="image-overlay">
                <button class="quick-view-btn" (click)="viewProduct(product)">
                  <ion-icon name="eye-outline"></ion-icon>
                  Ver detalles
                </button>
              </div>
            </div>

            <!-- Información del producto -->
            <div class="product-info">
              
              <!-- ID y Categoría -->
              <div>
                <span class="product-id" *ngIf="product.id">
                  ID: {{ product.id }}
                </span>
                <span class="product-category" *ngIf="product.categoria">
                  {{ product.categoria }}
                </span>
              </div>

              <!-- Nombre -->
              <h3 class="product-name">{{ product.nombre }}</h3>

              <!-- Descripción -->
              <p class="product-description">{{ product.descripcion }}</p>

              <!-- Marca -->
              <div class="product-brand" *ngIf="product.marca">
                <ion-icon name="ribbon-outline"></ion-icon>
                <span>{{ product.marca }}</span>
              </div>

              <!-- Footer con precio y botón -->
              <div class="product-footer">
                <div class="price-container">
                  <span class="price-label">Precio</span>
                  <span class="price">${{ product.precio | number:'1.2-2' }}</span>
                </div>

                <button class="add-to-cart-btn" (click)="addToCart(product)">
                  <span class="btn-icon">
                    <ion-icon name="cart-outline"></ion-icon>
                  </span>
                  <span class="btn-text">Agregar</span>
                </button>
              </div>

            </div>

          </div>
        </div>

      </div>
    </div>

  </section>

  <!-- MODAL DE DETALLES DEL PRODUCTO -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Detalles del Producto</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="modal-content">
        <div class="product-detail-container" *ngIf="selectedProduct">
          
          <!-- Imagen grande del producto -->
          <div class="detail-image-section">
            <img 
              [src]="selectedProduct.imagen || 'assets/img/placeholder.png'" 
              [alt]="selectedProduct.nombre"
              (error)="$event.target.src='assets/img/placeholder.png'"
            >
          </div>

          <!-- Información detallada -->
          <div class="detail-info-section">
            
            <!-- ID y Categoría -->
            <div class="detail-badges">
              <span class="detail-id" *ngIf="selectedProduct.id">
                <ion-icon name="cube-outline"></ion-icon>
                ID: {{ selectedProduct.id }}
              </span>
              <span class="detail-category" *ngIf="selectedProduct.categoria">
                {{ selectedProduct.categoria }}
              </span>
            </div>

            <!-- Nombre -->
            <h2 class="detail-name">{{ selectedProduct.nombre }}</h2>

            <!-- Marca -->
            <div class="detail-brand" *ngIf="selectedProduct.marca">
              <ion-icon name="ribbon-outline"></ion-icon>
              <span>Marca: <strong>{{ selectedProduct.marca }}</strong></span>
            </div>

            <!-- Descripción completa -->
            <div class="detail-description">
              <h3>Descripción</h3>
              <p>{{ selectedProduct.descripcion }}</p>
            </div>

            <!-- URL si existe -->
            <div class="detail-url" *ngIf="selectedProduct.url">
              <ion-icon name="link-outline"></ion-icon>
              <a [href]="selectedProduct.url" target="_blank">Ver más información</a>
            </div>

            <!-- Precio y controles -->
            <div class="detail-purchase-section">
              
              <!-- Selector de tipo de venta -->
              <div class="sale-type-selector">
                <h3>Selecciona tipo de venta</h3>
                <div class="sale-type-buttons">
                  <button 
                    class="sale-type-btn" 
                    [class.active]="saleType === 'menudeo'"
                    (click)="selectSaleType('menudeo')">
                    <ion-icon name="cart-outline"></ion-icon>
                    <div class="sale-type-info">
                      <span class="sale-type-title">Menudeo</span>
                      <span class="sale-type-desc">Venta al detalle</span>
                    </div>
                  </button>
                  
                  <button 
                    class="sale-type-btn" 
                    [class.active]="saleType === 'mayoreo'"
                    (click)="selectSaleType('mayoreo')">
                    <ion-icon name="business-outline"></ion-icon>
                    <div class="sale-type-info">
                      <span class="sale-type-title">Mayoreo</span>
                      <span class="sale-type-desc">15% descuento</span>
                    </div>
                  </button>
                </div>
              </div>

              <div class="detail-price-container">
                <span class="detail-price-label">
                  Precio {{ saleType === 'mayoreo' ? 'de Mayoreo' : 'de Menudeo' }}
                </span>
                <div class="price-display">
                  <span class="detail-price">${{ getCurrentPrice() | number:'1.2-2' }}</span>
                  <span class="price-unit">por unidad</span>
                </div>
                <div class="price-savings" *ngIf="saleType === 'mayoreo'">
                  <ion-icon name="pricetag-outline"></ion-icon>
                  Ahorras: ${{ (selectedProduct!.precio - getCurrentPrice()) | number:'1.2-2' }} por unidad
                </div>
              </div>

              <!-- Selector de cantidad -->
              <div class="quantity-selector">
                <button class="quantity-btn" (click)="decrementQuantity()">
                  <ion-icon name="remove-outline"></ion-icon>
                </button>
                <span class="quantity-value">{{ quantity }}</span>
                <button class="quantity-btn" (click)="incrementQuantity()">
                  <ion-icon name="add-outline"></ion-icon>
                </button>
              </div>

              <!-- Total -->
              <div class="total-section">
                <span class="total-label">Total a pagar</span>
                <span class="total-price">${{ getTotal() | number:'1.2-2' }}</span>
              </div>

              <!-- Botón agregar al carrito -->
              <button class="modal-add-to-cart-btn" (click)="addToCartFromModal()">
                <ion-icon name="cart-outline"></ion-icon>
                Agregar al carrito
              </button>
            </div>

          </div>

        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <app-footer></app-footer>

</ion-content>